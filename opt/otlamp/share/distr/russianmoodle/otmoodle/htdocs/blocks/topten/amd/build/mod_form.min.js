define(["jquery","core/ajax","core/fragment","core/templates","core/notification","core/str"],function(a,b,c,d,e,f){return{_dialogue:a.Deferred(),_formElement:null,init:function(){var b=this;b.resetDeferred(),b._formElement=a("form.mform.block_topten-js"),b._formElement.find("fieldset select#id_config_rating_type").change(function(){var a="",c=b._formElement.find("input[name=id]");c.length>0&&(a="&id="+c.val());var d="",e=b._formElement.find("input[name=cid]");e.length>0&&(d="&cid="+e.val()),window.location.replace(b._formElement.attr("action")+"?bui_editid="+b._formElement.find("input[name=bui_editid]").val()+"&sesskey="+b._formElement.find("input[name=sesskey]").val()+"&type="+this.value+a+d)});var c=b._formElement.find(".system_search_button");c.unbind("click").click(function(){var c=a(this);c.addClass("disabled"),f.get_strings([{key:"courses_search_filter_header",component:"block_topten"},{key:"courses_search_filter_save",component:"block_topten"},{key:"courses_search_filter_cancel",component:"block_topten"}]).done(function(c){e.confirm(c[0],'<div class="search-form-container loading"></div>',c[1],c[2],function(){b.saveFormdata(a(".search-form-container").find("form"),a("form.mform.block_topten-js").find('input[name="config_courses_search_crws"]'))}),setTimeout(function(){b._dialogue.resolve()},500)}).fail(e.exception).always(function(){c.removeClass("disabled")})}),c.removeClass("disabled")},resetDeferred:function(){var b=this;b._dialogue=a.Deferred(),a.when(b._dialogue).done(function(){a(".search-form-container").closest(".moodle-dialogue-wrap").addClass("moodle-dialogue-top_ten-courses_search"),b.loadForm(a(".search-form-container")),b.resetDeferred()})},getSavedCrws:function(){var b=a("form.mform.block_topten-js").find('input[name="config_courses_search_crws"]');return b.length>0&&""!=b.val()?b.val():""},processForm:function(a,b){var d=this,f=d._formElement.find('input[name="contextid"]').val(),g={rating_type:"courses_search",output_fragment:"search_form",crws:d.getSavedCrws()};void 0!==b&&(g.formdata=JSON.stringify(b)),c.loadFragment("block_topten","router",f,g).done(a).fail(e.exception)},loadForm:function(b){var c=this;c.processForm(function(c,e){c=JSON.parse(c),d.replaceNodeContents(b,c.html,e);var f=a(".crw_system_search_form");f.submit(function(b){b.preventDefault();var c=a(".moodle-dialogue-top_ten-courses_search");c.find(".confirmation-dialogue > .confirmation-buttons > .btn-primary").trigger("click")}),b.removeClass("loading")})},saveFormdata:function(a,b){var c=this,d="";a.length>0&&c.processForm(function(a){a=JSON.parse(a),d=a.crws,b.length>0&&b.val(d)},a.serialize())}}});