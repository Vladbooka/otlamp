<?phpclass dof_modlib_templater_format_xls extends dof_modlib_templater_format{    public function __construct($dof, $plugintype, $pluginname, $templatename = null)    {        // Базовая инициализация экспортера        parent::__construct($dof, $plugintype, $pluginname, $templatename);                // Подключение класса работы с Excel        global $CFG;        require_once("$CFG->libdir/excellib.class.php");    }        /**     * Отправить заголовки в браузер     */    public function get_headers($options = null)    {        $rez = [];        return $rez;    }    
    /**     * Получить контент файла для экспорта     */    public function get_file($options = null)    {        // Получение имени файла        $filename = $this->get_filename($options);                // Инициализация нового файла xls        $workbook = new MoodleExcelWorkbook($filename);                // Инициализация нового листа        $title = '-';        if ( isset($options->title) )        {//покажем заголовки таблицы или нет -            $title = $options->title;        }        $list = $workbook->add_worksheet($title);                // Получаем имя поле с данными экспорта        if ( ! $field = $this->get_field_name() )        {// Имя поля не получено            return '';        }                // Получение данных для экспорта        $data = $this->get_data_forexport($field);        if ( ! $data  )        {            return '';        }                // Заполнение отчета данными        $currentrownum = 0;        $currentcolnum = 0;                foreach ( $data as $row )        {// Добавление строки в отчет                        foreach ( $row as $cell )            {// Добавление ячейки в строку                                $list->write_string($currentrownum, $currentcolnum, $cell);                $currentcolnum++;            }            $currentcolnum = 0;            $currentrownum++;        }        // Отправка файла        $workbook->close();                die;    }        /**     * Получить имя экспортируемого файла     */    public function get_filename($options=null)    {        // устанавливаем имя файла и расширение по умолчанию        $filename  = $this->templatename;        $extention = 'xls';        if (!empty($options->filename) AND is_string($options->filename))        {// определяем новое имя файла, если оно есть';            $options->filename = trim($options->filename);            if ($options->filename)            {// если имя файла задано принудительно - используем его                $filename = $options->filename;            }        }        return $filename.'.'.$extention;    }	    /**     * Возвращает имя поля, которое содержит данные для обработки     *      * @return string - имя поля или bool false     */    protected function get_field_name()    {        // Нет подходящих полей для экспорта        return false;    }        /**     * Получение данных для экспорта     *     * @param string $name - Имя свойства объекта отчета с данными для экспорта     *     * @return mixed array - массив объектов для вставки     * или bool false     */    protected function get_data_forexport($name)    {        if ( ! is_string($name) )        {//неправильные входные данные            return false;        }        if ( ! isset($this->data->$name) )        {//нет такого свойства в данных экспорта            return false;        }        return $this->data->$name;    }
}?>