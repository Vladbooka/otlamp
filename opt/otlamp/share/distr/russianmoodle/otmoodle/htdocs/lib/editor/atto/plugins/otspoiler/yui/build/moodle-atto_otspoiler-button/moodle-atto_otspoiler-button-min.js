YUI.add("moodle-atto_otspoiler-button",function(e,t){var n="atto_otspoiler";e.namespace("M.atto_otspoiler").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){this.addButton({icon:"icon",iconComponent:"atto_otspoiler",title:"spoiler",buttonName:"spoiler",callback:this._spoiler})},_spoiler:function(){var e=this.unspoil();e||this.spoil()},unspoil:function(){var e=window.rangy.saveSelection(),t=this.editor.all("blockquote"),n=t.size();this.editor.all(".rangySelectionBoundary").setStyle("display",null),t.addClass("pre-existing");var r=this.replaceEditorSpoilers(this.editor);return window.rangy.restoreSelection(e),e=window.rangy.saveSelection(),document.execCommand("outdent",!1,null),t=this.editor.all("blockquote"),t.size()!==n?(this.replaceBlockquote(this.editor),window.rangy.restoreSelection(e)):t.size()>0&&t.removeClass("pre-existing"),window.rangy.removeMarkers(e),this.markUpdated(),t.size()!==r},spoil:function(){var e=window.rangy.saveSelection(),t=this.editor.all("blockquote"),n=t.size();this.editor.all(".rangySelectionBoundary").setStyle("display",null),t.addClass("pre-existing"),document.execCommand("indent",!1,null),t=this.editor.all("blockquote"),t.size()!==n?(this.replaceBlockquote(this.editor),window.rangy.restoreSelection(e)):t.size()>0&&t.removeClass("pre-existing"),window.rangy.removeMarkers(e),this.markUpdated()},replaceBlockquote:function(t){t.all("blockquote").setAttribute("data-iterate",!0);var n=t.one("blockquote");while(n){n.removeAttribute("data-iterate");if(n.hasClass("pre-existing"))n.removeClass("pre-existing");else{var r=e.Node.create("<div></div>").setAttrs(n.getAttrs()).addClass("otspoiler"),i=n.getDOMNode().childNodes,s;s=i[0];while(typeof s!="undefined")r.append(s),s=i[0];n.replace(r)}n=t.one("blockquote[data-iterate]")}},replaceEditorSpoilers:function(t){var n=0,r=t.one(".otspoiler");while(r){n++;var i=e.Node.create("<blockquote></blockquote>").setAttrs(r.getAttrs()).removeClass("otspoiler"),s=r.getDOMNode().childNodes,o;o=s[0];while(typeof o!="undefined")i.append(o),o=s[0];r.replace(i),r=t.one(".otspoiler")}return n}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
