define(["jquery"],function(a){return{__edge:50,__defaults:{"object-fit":"fill","object-position":"50% 50%"},__setDefaults:function(a){a.css(this.__defaults)},__rescalePosition:function(a,b,c,d,e,f){var g=(e-d)/(c-b),h=(a-b)*g+d;return f&&(h=h<b?b:h>c?c:h),h},__addImgHandlers:function(a){var b=this;a.on("mousemove",function(c){var d=a.width(),e=c.pageX-a.offset().left,f=b.__edge;f>d/6&&(f=Math.ceil(d/6)),e=b.__rescalePosition(e,0,d,0-f,d+f,!0);var g=a.height(),h=c.pageY-a.offset().top,i=b.__edge;i>d/6&&(i=Math.ceil(g/6)),h=b.__rescalePosition(h,0,g,0-i,g+i,!0),a.css({"object-fit":"none","object-position":100*e/d+"% "+100*h/g+"%"})}),a.on("mouseout",function(){b.__setDefaults(a)})},__initMagnifier:function(b){var c=this,d=new Image;d.onload=function(){(d.naturalWidth>b.width()||d.naturalHeight>b.height())&&(c.__setDefaults(b),b.off("mousemove, mouseout"),c.__addImgHandlers(b))},d.src=b.attr("src"),b.hasClass("magnifier-open")&&(b.off("click"),b.addClass("magnifier-clickable"),b.on("click",function(){var b={url:a(this).attr("src"),options:""};a(this).hasClass("magnifier-separate-window")&&(b.fullscreen=a(this).hasClass("magnifier-fullscreen"),b.options=["height=600","width=800","top=0","left=0","menubar=0","location=0","scrollbars","resizable","toolbar","status","directories=0","fullscreen=0","dependent"].join(",")),window.openpopup(!1,b)}))},init:function(){var b=this;a("img.magnifier").each(function(){0==a(this).parents(".editor_atto").length&&b.__initMagnifier(a(this))})}}});