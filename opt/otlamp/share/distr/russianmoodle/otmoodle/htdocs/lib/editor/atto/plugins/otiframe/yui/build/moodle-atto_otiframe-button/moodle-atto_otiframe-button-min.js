YUI.add("moodle-atto_otiframe-button",function(c,t){var h="atto_otiframe",i={URLINPUT:"atto_otiframe_urlentry",AUTOSIZE:"atto_otiframe_autosize",MANUALSIZE:"atto_otiframe_manualsize",INPUTWIDTH:"atto_otiframe_widthentry",INPUTHEIGHT:"atto_otiframe_heightentry"},a=".atto_otiframe_urlentry",d=".atto_otiframe_autosize",u=".atto_otiframe_widthentry",_=".atto_otiframe_heightentry";c.namespace("M.atto_otiframe").Button=c.Base.create("button",c.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_content:null,initializer:function(){this.addButton({icon:"icon",iconComponent:"atto_otiframe",keys:"75",callback:this._displayDialogue,tags:"iframe",tagMatchRequiresAll:!1});var e=!1;this.editor.delegate("mouseover",function(t){e=t.target,this.editor.focus()},"iframe",this),this.editor.delegate("mouseout",function(){e=!1},"iframe",this),this.editor.delegate("blur",function(t){e&&(t.preventDefault(),this._handleClick.call(this,e))},null,this)},_handleClick:function(t){var e=this.get("host");e.focus(),e.setSelection(e.getSelectionFromNode(t)),e.focus()},_displayDialogue:function(){if(this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection){var t=this.getDialogue({headerContent:M.util.get_string("createotiframe",h),width:"auto",focusAfterHide:!0,focusOnShowSelector:a});t.set("bodyContent",this._getDialogueContent()),this._resolveAnchors(),t.show()}},_resolveAnchors:function(){var t,e,i,o,n,s=this.get("host"),r=s.getSelectionParentNode();this.__srcdoc="",r&&0<(t=this._findSelectedAnchors(c.one(r))).length&&(e=t[0],this._currentSelection=s.getSelectionFromNode(e),""!==(i=e.getAttribute("data-source"))&&this._content.one(a).setAttribute("value",i),this.__srcdoc=e.getAttribute("srcdoc"),o=e.getAttribute("width"),n=e.getAttribute("height"),""==o&&""==n?(this._content.one(u).setAttribute("disabled","disabled"),this._content.one(_).setAttribute("disabled","disabled"),this._content.one(d).setAttribute("checked","checked")):(this._content.one(u).removeAttribute("disabled"),this._content.one(_).removeAttribute("disabled"),this._content.one(d).removeAttribute("checked"),""!==o&&this._content.one(u).setAttribute("value",o),""!==n&&this._content.one(_).setAttribute("value",n)))},_filepickerCallback:function(t){this.getDialogue().set("focusAfterHide",null).hide(),""!==t.url&&this._setOtiframeOnSelection(t.url)},_setOtiframe:function(t){var e;t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),""!==(e=this._content.one(".url").get("value"))&&(e=e.trim(),new RegExp(/^[a-zA-Z]*\.*\/|^#|^[a-zA-Z]*:/).test(e)||(e="http://"+e),this._setOtiframeOnSelection(e))},_setOtiframeOnSelection:function(t){var e,i,o,n,s=this.get("host"),r=this._content.one(u).get("value"),a=this._content.one(_).get("value"),l=this._content.one(d).get("checked");s.focus(),""!==t&&(s.setSelection(this._currentSelection),o=c.Handlebars.compile('<iframe class="otiframe {{#if autosize}}autosize{{/if}}" {{#if haswidth}}width="{{width}} "{{/if}}{{#if hasheight}}height="{{height}} "{{/if}}srcdoc="{{#if srcdoc}}{{srcdoc}}{{else}}{{get_string "srcdoc" component}}{{/if}}" data-source="{{url}}" />'),n={url:t,autosize:l,haswidth:!l&&""!==r,width:r,hasheight:!l&&""!==a,height:a,component:h},this.__srcdoc&&(n.srcdoc=this.__srcdoc),e=o(n),i=s.insertContentAtFocusPoint(e),s.setSelection(s.getSelectionFromNode(i)),this.markUpdated())},_findSelectedAnchors:function(t){var e,i,o=t.get("tagName");return o&&"iframe"===o.toLowerCase()?[t]:(i=[],t.all("iframe").each(function(t){!e&&this.get("host").selectionContainsNode(t)&&i.push(t)},this),0<i.length?i:(e=t.ancestor("iframe"))?[e]:[])},_getDialogueContent:function(){var t=this.get("host").canShowFilepicker("link"),e=c.Handlebars.compile('<form class="atto_form">{{#if showFilepicker}}<label for="{{elementid}}_atto_otiframe_urlentry">{{get_string "enterurl" component}}</label><div class="input-group input-append w-100 m-b-1"><input class="form-control url {{CSS.URLINPUT}}" type="url" id="{{elementid}}_atto_otiframe_urlentry"/><span class="input-group-append"><button class="btn btn-default openotiframebrowser" type="button">{{get_string "browserepositories" component}}</button></span></div>{{else}}<div class="m-b-1"><label for="{{elementid}}_atto_otiframe_urlentry">{{get_string "enterurl" component}}</label><input class="form-control fullwidth url {{CSS.URLINPUT}}" type="url" id="{{elementid}}_atto_otiframe_urlentry" size="32"/></div>{{/if}}<div class="form-check"><input type="checkbox" class="form-check-input fullscreen {{CSS.AUTOSIZE}}" id="{{elementid}}_{{CSS.AUTOSIZE}}" checked="checked"/><label class="form-check-label" for="{{elementid}}_{{CSS.AUTOSIZE}}">{{get_string "size_auto" component}}</label></div><div class="mb-1"><label class="" for="{{elementid}}_{{CSS.INPUTSIZE}}">{{get_string "size_manual" component}}</label><div id="{{elementid}}_{{CSS.MANUALSIZE}}" class="form-inline {{CSS.MANUALSIZE}}"><label class="accesshide" for="{{elementid}}_{{CSS.INPUTWIDTH}}">{{get_string "width" component}}</label><input type="text" class="form-control mr-1 input-mini {{CSS.INPUTWIDTH}}" id="{{elementid}}_{{CSS.INPUTWIDTH}}" size="4" disabled="disabled"/> x<label class="accesshide" for="{{elementid}}_{{CSS.INPUTHEIGHT}}">{{get_string "height" component}}</label><input type="text" class="form-control ml-1 input-mini {{CSS.INPUTHEIGHT}}" id="{{elementid}}_{{CSS.INPUTHEIGHT}}" size="4" disabled="disabled"/></div></div><div class="mdl-align"><br/><button type="submit" class="btn btn-default submit">{{get_string "createotiframe" component}}</button></div></form>');return this._content=c.Node.create(e({showFilepicker:t,component:h,CSS:i})),this._content.one("."+i.INPUTHEIGHT).on("blur",this._autoAdjustSize,this,!0),this._content.one(d).on("change",function(t){t.target.get("checked")?(this._content.one(u).setAttribute("disabled","disabled"),this._content.one(_).setAttribute("disabled","disabled")):(this._content.one(u).removeAttribute("disabled"),this._content.one(_).removeAttribute("disabled"))},
this),this._content.one(".submit").on("click",this._setOtiframe,this),t&&this._content.one(".openotiframebrowser").on("click",function(t){t.preventDefault(),this.get("host").showFilepicker("link",this._filepickerCallback,this)},this),this._content}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});