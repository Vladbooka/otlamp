YUI.add("moodle-availability_otcomparison-form",function(p,e){M.availability_otcomparison=M.availability_otcomparison||{},M.availability_otcomparison.form=p.Object(M.core_availability.plugin),M.availability_otcomparison.form.initInner=function(e){this.fields=[],this.preprocessors=[],this.operators=[],this.date_example="",this.days_explanation="",e!==undefined&&(e.fields!==undefined&&(this.fields=e.fields),e.preprocessors!==undefined&&(this.preprocessors=e.preprocessors),e.operators!==undefined&&(this.operators=e.operators),e.date_example!==undefined&&(this.date_example=e.date_example),e.days_explanation!==undefined&&(this.days_explanation=e.days_explanation))},M.availability_otcomparison.form.getNode=function(e){var o,a,t,i,l=this,n=M.str.availability_otcomparison,s=[],r=[];for(o in r.push('<option value="0">'+n.choose_source+"</option>"),l.fields)r.push('<option value="'+o+'">'+l.fields[o].name+"</option>");for(a in s.push('<select name="source" class="custom-select col-12 mb-3">'+r.join("")+"</select>"),(r=[]).push('<option value="0">'+n.choose_preprocessor+"</option>"),this.preprocessors)r.push('<option value="'+a+'">'+this.preprocessors[a]+"</option>");for(a in s.push('<select name="preprocessor" class="custom-select col-5">'+r.join("")+"</select>"),(r=[]).push('<option value="0">'+n.choose_operator+"</option>"),this.operators)r.push('<option value="'+a+'">'+this.operators[a]+"</option>");return s.push('<select name="operator" class="custom-select col-4">'+r.join("")+"</select>"),s.push('<input type="text" name="amount" value="" class="form-control col-2"/>'),s.push('<div class="otcomparison_date_example" style="display: none;">'+l.date_example+"</div>"),s.push('<div class="otcomparison_days_explanation" style="display: none;">'+l.days_explanation+"</div>"),t=p.Node.create('<div class="row justify-content-between">'+s.join("")+"</div>"),e.source!==undefined&&null!=t.one("select[name=source]>option[value="+e.source+"]")&&t.one("select[name=source]").set("value",e.source),M.availability_otcomparison.form.loadPreprocessors(l,t,e.preprocessor),e.operator!==undefined&&null!=t.one("select[name=operator]>option[value="+e.operator+"]")&&t.one("select[name=operator]").set("value",e.operator),e.amount!==undefined&&null!=t.one("input[name=amount]")&&t.one("input[name=amount]").set("value",e.amount),M.availability_otcomparison.form.addedEvents||(M.availability_otcomparison.form.addedEvents=!0,p.one(".availability-field").delegate("valuechange",function(){M.core_availability.form.update()},".availability_otcomparison select[name=source],.availability_otcomparison select[name=preprocessor],.availability_otcomparison select[name=operator],.availability_otcomparison input[type=text][name=amount]")),t.one("select[name=source]").on("change",function(){var e=t;M.availability_otcomparison.form.loadPreprocessors(l,e)}),(i=t.one("select[name=preprocessor]")).on("change",function(e){var o=t;M.availability_otcomparison.form.loadExample(l,o,e.currentTarget)}),M.availability_otcomparison.form.loadExample(l,t,i),t},M.availability_otcomparison.form.loadExample=function(e,o,a){var t,i=o.one("div.otcomparison_date_example");null!=i&&null!=a&&("date"==a.get("value")?i.show():i.hide()),null!=(t=o.one("div.otcomparison_days_explanation"))&&null!=a&&("days"==a.get("value")?t.show():t.hide())},M.availability_otcomparison.form.loadPreprocessors=function(e,o,a){var t,i,l,n,s,r=o.one("select[name=source]"),p=o.one("select[name=preprocessor]");void 0===a?null!==(i=p.one("option:checked"))&&(t=i.get("value")):t=a,null!==r&&null!==p&&(null!==(l=r.one("option:checked"))&&"0"!==l.get("value")?(p.removeAttribute("disabled"),p.all("option").removeAttribute("disabled"),n=l.get("value"),"undefined"!=typeof e.fields[n]&&"datetime"!=e.fields[n].type&&(p.one("option[value=date]").set("disabled","disabled"),p.one("option[value=days]").set("disabled","disabled")),null!==t&&null!==(s=p.one("option[value="+t+"]"))&&(null!==s.get("disabled")&&!1!==s.get("disabled")?p.set("value","0"):p.set("value",t))):(p.set("value","0"),p.set("disabled","disabled")))},M.availability_otcomparison.form.fillValue=function(e,o){var a,t,i,l=o.one("select[name=source] option:checked");null!==l&&(e.source=l.get("value")),null!==(a=o.one("select[name=preprocessor] option:checked"))&&(e.preprocessor=a.get("value")),null!==(t=o.one("select[name=operator] option:checked"))&&(e.operator=t.get("value")),null!==(i=o.one("input[type=text][name=amount]"))&&(e.amount=i.get("value"))},M.availability_otcomparison.form.fillErrors=function(e,o){var a,t,i,l,n=o.one("select[name=source] option:checked");null!==n&&"0"==n.get("value")&&e.push("availability_otcomparison:error_selectsource"),null!==(a=o.one("select[name=preprocessor] option:checked"))&&"0"==a.get("value")&&e.push("availability_otcomparison:error_selectpreprocessor"),null!==(t=o.one("select[name=operator] option:checked"))&&"0"==t.get("value")&&e.push("availability_otcomparison:error_selectoperator"),null!==(i=o.one("input[type=text][name=amount]"))&&(""==(l=i.get("value"))&&e.push("availability_otcomparison:error_fillvalue"),null!==a&&"date"!=a.get("value")&&(/^-?[0-9]+$/.test(""+l)||e.push("availability_otcomparison:error_invalidfilledvalue")))}},"@VERSION@",{requires:["base","node","event","moodle-core_availability-form"]});