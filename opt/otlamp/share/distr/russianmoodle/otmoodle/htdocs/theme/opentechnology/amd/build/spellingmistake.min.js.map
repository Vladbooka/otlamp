{"version":3,"sources":["../src/spellingmistake.js"],"names":["define","$","ajax","strman","flashmessage","body","forbiddenTags","entityMap","STRINGS","ORFOMODAL","label","n","CONTROLLER","clearText","txt","test","replace","s","extractTextFromNode","j","length","remove","nHtml","innerHTML","DOMParser","parseFromString","innerText","extractTextFromRange","range","result","clonedContent","cloneContents","nodes","children","childNodes","texts","i","len","push","join","e","toString","getSelectionText","win","text","window","doc","document","getSelection","selection","type","createRange","getSelectedPhrase","rangeCount","rangeObj","getRangeAt","startContainer","endContainer","nodeName","parentNode","anchorNode","node","commonAncestorContainer","parentElement","item","nLen","cloneNode","getAroundSelectedText","containerEl","get","sel","tempRange","before","after","collapse","selectNodeContents","setEnd","startOffset","setStart","endOffset","createTextRange","moveToElementText","setEndPoint","displayModal","drama","html","addClass","append","hideModal","removeClass","setStrings","get_strings","key","component","done","strs","keydownHandler","ctrlKey","metaKey","keyCode","currentTarget","parentWindow","defaultView","phrase","aroundText","aroundTextStart","slice","aroundTextEnd","on","promises","call","methodname","args","location","closest","find","val","addMessage","fail","console","always","keyupHandler","init","kdh","bind","kuh","off","each","contentWindow","observer","MutationObserver","iframe","timerid","setInterval","setTimeout","clearInterval","observe","subtree","attributes","childList","characterData"],"mappings":"AAAAA,OAAM,wCAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,UAAxB,CAAoC,mCAApC,CAAD,CAA2E,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA0BC,CAA1B,CAAwC,CACrH,MAAO,CACHC,IAAI,CAAEJ,CAAC,CAAC,MAAD,CADJ,CAEHK,aAAa,CAAE,CAAC,QAAD,CAAW,OAAX,CAAoB,OAApB,CAA6B,QAA7B,CAAuC,MAAvC,CAA+C,MAA/C,CAAuD,KAAvD,CAFZ,CAGHC,SAAS,CAAE,CAAC,IAAK,OAAN,CAAe,IAAK,MAApB,CAA4B,IAAK,MAAjC,CAAyC,IAAK,QAA9C,CAAwD,IAAK,OAA7D,CAAsE,IAAK,QAA3E,CAHR,CAIHC,OAAO,CAAE,CACL,6BAAgC,aAD3B,CAEL,oCAAuC,aAFlC,CAGL,oCAAuC,aAHlC,CAIL,2CAA8C,aAJzC,CAKL,6BAAgC,aAL3B,CAML,0BAA6B,aANxB,CAOL,+BAAkC,aAP7B,CAQL,4BAA+B,aAR1B,CAJN,CAcHC,SAAS,CAAE,IAdR,CAgBHC,KAAK,CAAE,eAAUC,CAAV,CAAa,CAChB,GAAIC,CAAAA,CAAU,CAAG,IAAjB,CACA,MAAOA,CAAAA,CAAU,CAACJ,OAAX,CAAmBG,CAAnB,CACV,CAnBE,CAoBHE,SAAS,CAAE,mBAASC,CAAT,CAAa,CACpB,GAAIF,CAAAA,CAAU,CAAG,IAAjB,CACA,GAAI,KAAKG,IAAL,CAAUD,CAAV,CAAJ,CAAoB,CAChB,MAAOA,CAAAA,CAAG,CAACE,OAAJ,CAAY,gBAAZ,CAA8B,GAA9B,EAAmCA,OAAnC,CAA2C,MAA3C,CAAmD,GAAnD,EAAwDA,OAAxD,CAAgE,YAAhE,CAA8E,SAAUC,CAAV,CAAa,CAC9F,MAAOL,CAAAA,CAAU,CAACL,SAAX,CAAqBU,CAArB,CACV,CAFM,CAGV,CACJ,CA3BE,CA4BHC,mBAAmB,CAAE,6BAASP,CAAT,CAAW,CAE5B,OADIC,CAAAA,CAAU,CAAG,IACjB,CAASO,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGP,CAAU,CAACN,aAAX,CAAyBc,MAA7C,CAAqDD,CAAC,EAAtD,CAA0D,CACtDlB,CAAC,CAACW,CAAU,CAACN,aAAX,CAAyBa,CAAzB,CAAD,CAA8BR,CAA9B,CAAD,CAAkCU,MAAlC,EACH,CAJ2B,GAKxBC,CAAAA,CAAK,CAAGX,CAAC,CAACY,SAAF,CAAYP,OAAZ,CAAoB,KAApB,CAA2B,IAA3B,CALgB,CAMxBF,CAAG,CAAI,GAAIU,CAAAA,SAAJ,EAAD,CAAkBC,eAAlB,CAAkCH,CAAlC,CAAyC,WAAzC,EAAsDjB,IAAtD,CAA2DqB,SAA3D,EAAwE,EANtD,CAO5BZ,CAAG,CAAGA,CAAG,CAACE,OAAJ,CAAY,WAAZ,CAAyB,GAAzB,EAA8BA,OAA9B,CAAsC,YAAtC,CAAoD,EAApD,EAAwDA,OAAxD,CAAgE,SAAhE,CAA2E,GAA3E,CAAN,CACA,MAAOF,CAAAA,CACV,CArCE,CAsCHa,oBAAoB,CAAE,8BAASC,CAAT,CAAe,IAC7BhB,CAAAA,CAAU,CAAG,IADgB,CAE7BiB,CAAM,CAAG,EAFoB,CAGjC,GAAI,CAIA,OAHIC,CAAAA,CAAa,CAAGF,CAAK,CAACG,aAAN,EAGpB,CAFIC,CAAK,CAAGF,CAAa,CAACG,QAAd,EAA0BH,CAAa,CAACI,UAEpD,CADIC,CAAK,CAAG,EACZ,CAASC,CAAC,CAAG,CAAb,CAAgBC,CAAG,CAAGL,CAAK,CAACZ,MAA5B,CACQN,CADR,CAAoCsB,CAAC,CAAGC,CAAxC,CAA6CD,CAAC,EAA9C,CAAkD,CAC1CtB,CAD0C,CACpCF,CAAU,CAACM,mBAAX,CAA+Bc,CAAK,CAACI,CAAD,CAApC,CADoC,CAE9C,GAAI,KAAKrB,IAAL,CAAUD,CAAV,CAAJ,CAAoB,CAChBqB,CAAK,CAACG,IAAN,CAAWxB,CAAX,CACH,CACJ,CACDe,CAAM,CAAGM,CAAK,CAACI,IAAN,CAAW,GAAX,CACZ,CAAC,MAAMC,CAAN,CAAS,CACPX,CAAM,CAAGjB,CAAU,CAACC,SAAX,CAAqBe,CAAK,CAACa,QAAN,EAArB,CACZ,CACD,MAAOZ,CAAAA,CACV,CAxDE,CAyDHa,gBAAgB,CAAE,0BAASC,CAAT,CAAc,IACxB/B,CAAAA,CAAU,CAAG,IADW,CAExBgC,CAAI,CAAG,EAFiB,CAI5B,GAAID,CAAG,SAAP,CACA,CACIA,CAAG,CAAGE,MACT,CAED,GAAIC,CAAAA,CAAG,CAAGH,CAAG,CAACI,QAAd,CAEA,GAAIJ,CAAG,CAACK,YAAR,CAAsB,CAClBJ,CAAI,CAAGD,CAAG,CAACK,YAAJ,GAAmBP,QAAnB,EACV,CAFD,IAEO,IAAIK,CAAG,CAACG,SAAJ,EAAuC,SAAtB,EAAAH,CAAG,CAACG,SAAJ,CAAcC,IAAnC,CAAsD,CACzDN,CAAI,CAAGE,CAAG,CAACG,SAAJ,CAAcE,WAAd,GAA4BP,IACtC,CACD,MAAOhC,CAAAA,CAAU,CAACC,SAAX,CAAqB+B,CAArB,CACV,CA1EE,CA2EHQ,iBAAiB,CAAE,4BAAU,CACzB,GAAIxC,CAAAA,CAAU,CAAG,IAAjB,CACA,GAAG,CACC,GAAIoB,CAAAA,CAAK,CAAG,EAAZ,CAAgBG,CAAK,CAAG,EAAxB,CAA4Bc,CAA5B,CACA,GAAIJ,MAAM,CAACG,YAAX,CAAyB,CACrBC,CAAS,CAAGD,YAAY,EAAxB,CACA,IAAK,GAAIZ,CAAAA,CAAC,CAAG,CAAR,CAAWC,CAAG,CAAGY,CAAS,CAACI,UAAhC,CAA4CjB,CAAC,CAAGC,CAAhD,CAAqDD,CAAC,EAAtD,CAA0D,CACtD,GAAIkB,CAAAA,CAAQ,CAAGL,CAAS,CAACM,UAAV,CAAqBnB,CAArB,CAAf,CACIoB,CAAc,CAAGF,CAAQ,CAACE,cAD9B,CAEIC,CAAY,CAAGH,CAAQ,CAACG,YAF5B,CAGA,GAAID,CAAJ,CAAoB,CAChBxB,CAAK,CAACM,IAAN,CAAuC,OAA5B,GAAAkB,CAAc,CAACE,QAAf,CAAsCF,CAAc,CAACG,UAArD,CAAkEH,CAA7E,CACH,CACD,GAAIC,CAAJ,CAAkB,CACdzB,CAAK,CAACM,IAAN,CAAqC,OAA1B,GAAAmB,CAAY,CAACC,QAAb,CAAoCD,CAAY,CAACE,UAAjD,CAA8DF,CAAzE,CACH,CACJ,CACD,GAAqB,CAAjB,GAAAzB,CAAK,CAACZ,MAAV,CAAwB,CACpBY,CAAK,CAAG,CAACiB,CAAS,CAACW,UAAX,CACX,CACJ,CACD,GAAI,CAAC5B,CAAK,CAACZ,MAAP,EAAiB2B,QAAQ,CAACE,SAA9B,CAAyC,CACrCA,CAAS,CAAGF,QAAQ,CAACE,SAArB,CADqC,GAEjCrB,CAAAA,CAAK,CAAGqB,CAAS,CAACM,UAAV,CAAuBN,CAAS,CAACM,UAAV,CAAqB,CAArB,CAAvB,CAAiDN,CAAS,CAACE,WAAV,EAFxB,CAGjCU,CAAI,CAAGjC,CAAK,CAACkC,uBAAN,CAAgClC,CAAK,CAACkC,uBAAtC,CACHlC,CAAK,CAACmC,aAAN,CAAsBnC,CAAK,CAACmC,aAAN,EAAtB,CAA8CnC,CAAK,CAACoC,IAAN,CAAW,CAAX,CAJjB,CAKrC,GAAIH,CAAJ,CAAU,CACN7B,CAAK,CAAG,CAAC6B,CAAD,CACX,CACJ,CAED,IAAK,GAAIzB,CAAAA,CAAC,CAAG,CAAR,CAAW6B,CAAI,CAAGjC,CAAK,CAACZ,MAAxB,CACGyC,CADR,CAAqCzB,CAAC,CAAG6B,CAAzC,CAA+C7B,CAAC,EAAhD,CAAoD,CAC5CyB,CAD4C,CACrC7B,CAAK,CAACI,CAAD,CADgC,CAEhD,GAAqB,OAAjB,EAAAyB,CAAI,CAACH,QAAT,CAA8B,CAC1BG,CAAI,CAAGA,CAAI,CAACF,UACf,CACD,GAAI,CACAxB,CAAK,CAACG,IAAN,CAAW1B,CAAU,CAACM,mBAAX,CAA+B2C,CAAI,CAACK,SAAL,EAA/B,CAAX,CACH,CAAC,MAAM1B,CAAN,CAAS,CACPL,CAAK,CAACG,IAAN,CAAWrC,CAAC,CAAC4D,CAAD,CAAD,CAAQjB,IAAR,EAAX,CACH,CACJ,CACD,MAAOT,CAAAA,CAAK,CAACI,IAAN,CAAW,GAAX,CACV,CAAC,MAAOC,CAAP,CAAU,CACX,CACJ,CAxHE,CAyHH2B,qBAAqB,CAAE,+BAASC,CAAT,CAAqB,CACxC,GAAIxD,CAAAA,CAAU,CAAG,IAAjB,CACA,GAAI,CAACwD,CAAL,CAAkB,CACdA,CAAW,CAAGxD,CAAU,CAACP,IAAX,CAAgBgE,GAAhB,CAAoB,CAApB,CACjB,CACD,GAAIC,CAAAA,CAAJ,CAAS1C,CAAT,CAAgB2C,CAAhB,CAA2BC,CAAM,CAAG,EAApC,CAAwCC,CAAK,CAAG,EAAhD,CACA,GAAkC,WAA9B,QAAO5B,CAAAA,MAAM,CAACG,YAAlB,CAA+C,CAC3CsB,CAAG,CAAGzB,MAAM,CAACG,YAAP,EAAN,CACA,GAAIsB,CAAG,CAACjB,UAAR,CAAoB,CAChBzB,CAAK,CAAG0C,CAAG,CAACf,UAAJ,CAAe,CAAf,CACX,CAFD,IAEO,CACH3B,CAAK,CAAGmB,QAAQ,CAACI,WAAT,EAAR,CACAvB,CAAK,CAAC8C,QAAN,IACH,CACDH,CAAS,CAAGxB,QAAQ,CAACI,WAAT,EAAZ,CACAoB,CAAS,CAACI,kBAAV,CAA6BP,CAA7B,EACAG,CAAS,CAACK,MAAV,CAAiBhD,CAAK,CAAC4B,cAAvB,CAAuC5B,CAAK,CAACiD,WAA7C,EACAL,CAAM,CAAG5D,CAAU,CAACe,oBAAX,CAAgC4C,CAAhC,CAAT,CAEAA,CAAS,CAACI,kBAAV,CAA6BP,CAA7B,EACAG,CAAS,CAACO,QAAV,CAAmBlD,CAAK,CAAC6B,YAAzB,CAAuC7B,CAAK,CAACmD,SAA7C,EACAN,CAAK,CAAG7D,CAAU,CAACe,oBAAX,CAAgC4C,CAAhC,CACX,CAhBD,IAgBO,IAAI,CAACD,CAAG,CAAGvB,QAAQ,CAACE,SAAhB,GAA0C,SAAZ,EAAAqB,CAAG,CAACpB,IAAtC,CAAyD,CAC5DtB,CAAK,CAAG0C,CAAG,CAACnB,WAAJ,EAAR,CACAoB,CAAS,CAAGxB,QAAQ,CAAC1C,IAAT,CAAc2E,eAAd,EAAZ,CACAT,CAAS,CAACU,iBAAV,CAA4Bb,CAA5B,EACAG,CAAS,CAACW,WAAV,CAAsB,YAAtB,CAAoCtD,CAApC,EACA4C,CAAM,CAAG5D,CAAU,CAACC,SAAX,CAAqB0D,CAAS,CAAC3B,IAAV,EAAkB,EAAvC,CAAT,CAEA2B,CAAS,CAACU,iBAAV,CAA4Bb,CAA5B,EACAG,CAAS,CAACW,WAAV,CAAsB,YAAtB,CAAoCtD,CAApC,EACA6C,CAAK,CAAG7D,CAAU,CAACC,SAAX,CAAqB0D,CAAS,CAAC3B,IAAV,EAAkB,EAAvC,CACX,CAED,MAAO,CAAC,OAAU4B,CAAX,CAAmB,MAASC,CAA5B,CACV,CA5JE,CA6JHU,YAAY,CAAE,sBAASC,CAAT,CAAe,IACrBxE,CAAAA,CAAU,CAAG,IADQ,CAErByE,CAAI,CAAG,sSAIiDzE,CAAU,CAACF,KAAX,CAAiB,8BAAjB,CAJjD,kLAQqD0E,CARrD,sBASWxE,CAAU,CAACF,KAAX,CAAiB,qCAAjB,CATX,+BAU0BE,CAAU,CAACF,KAAX,CAAiB,4CAAjB,CAV1B,sMAeOE,CAAU,CAACF,KAAX,CAAiB,2BAAjB,CAfP,yFAiBOE,CAAU,CAACF,KAAX,CAAiB,8BAAjB,CAjBP,sDAkByCE,CAAU,CAACF,KAAX,CAAiB,qCAAjB,CAlBzC,4BAsBX,SAASM,OAAT,CAAiB,gBAAjB,CAAmC,EAAnC,EAAuCA,OAAvC,CAA+C,MAA/C,CAAuD,GAAvD,CAxByB,CA0BzBJ,CAAU,CAACH,SAAX,CAAuBR,CAAC,CAACoF,CAAD,CAAxB,CACAzE,CAAU,CAACP,IAAX,CAAgBiF,QAAhB,CAAyB,2BAAzB,EAAsDC,MAAtD,CAA6D3E,CAAU,CAACH,SAAxE,EACA,MAAOG,CAAAA,CAAU,CAACH,SACrB,CA1LE,CA2LH+E,SAAS,CAAE,oBAAU,CACjB,GAAI5E,CAAAA,CAAU,CAAG,IAAjB,CACAA,CAAU,CAACP,IAAX,CAAgBoF,WAAhB,CAA4B,2BAA5B,EACA,GAAI7E,CAAU,CAACH,SAAX,EAAsD,CAA9B,CAAAG,CAAU,CAACH,SAAX,CAAqBW,MAAjD,CAA6D,CACzDR,CAAU,CAACH,SAAX,CAAqBY,MAArB,EACH,CACJ,CAjME,CAmMHqE,UAAU,CAAE,qBAAW,CACnB,GAAI9E,CAAAA,CAAU,CAAG,IAAjB,CAGAT,CAAM,CAACwF,WAAP,CAAmB,CACf,CAAEC,GAAG,CAAE,8BAAP,CAAuCC,SAAS,CAAE,sBAAlD,CADe,CAEf,CAAED,GAAG,CAAE,qCAAP,CAA8CC,SAAS,CAAE,sBAAzD,CAFe,CAGf,CAAED,GAAG,CAAE,qCAAP,CAA8CC,SAAS,CAAE,sBAAzD,CAHe,CAIf,CAAED,GAAG,CAAE,4CAAP,CAAqDC,SAAS,CAAE,sBAAhE,CAJe,CAKf,CAAED,GAAG,CAAE,8BAAP,CAAuCC,SAAS,CAAE,sBAAlD,CALe,CAMf,CAAED,GAAG,CAAE,2BAAP,CAAoCC,SAAS,CAAE,sBAA/C,CANe,CAOf,CAAED,GAAG,CAAE,gCAAP,CAAyCC,SAAS,CAAE,sBAApD,CAPe,CAQf,CAAED,GAAG,CAAE,6BAAP,CAAsCC,SAAS,CAAE,sBAAjD,CARe,CAAnB,EASGC,IATH,CASQ,SAAUC,CAAV,CAAgB,CAGpBnF,CAAU,CAACJ,OAAX,8BAAqDuF,CAAI,CAAC,CAAD,CAAzD,CACAnF,CAAU,CAACJ,OAAX,qCAA4DuF,CAAI,CAAC,CAAD,CAAhE,CACAnF,CAAU,CAACJ,OAAX,qCAA4DuF,CAAI,CAAC,CAAD,CAAhE,CACAnF,CAAU,CAACJ,OAAX,4CAAmEuF,CAAI,CAAC,CAAD,CAAvE,CACAnF,CAAU,CAACJ,OAAX,8BAAqDuF,CAAI,CAAC,CAAD,CAAzD,CACAnF,CAAU,CAACJ,OAAX,2BAAkDuF,CAAI,CAAC,CAAD,CAAtD,CACAnF,CAAU,CAACJ,OAAX,gCAAuDuF,CAAI,CAAC,CAAD,CAA3D,CACAnF,CAAU,CAACJ,OAAX,6BAAoDuF,CAAI,CAAC,CAAD,CAC3D,CApBD,CAqBH,CA5NE,CA6NHC,cAAc,CAAE,wBAASxD,CAAT,CAAW,CACvB,GAAI5B,CAAAA,CAAU,CAAG,IAAjB,CACA,GAAI,CAAC4B,CAAC,CAACyD,OAAF,EAAazD,CAAC,CAAC0D,OAAhB,GAAyC,EAAb,EAAA1D,CAAC,CAAC2D,OAAlC,CAAiD,IACzCrD,CAAAA,CAAG,CAAGN,CAAC,CAAC4D,aADiC,CAEzCzD,CAAG,CAAGG,CAAG,CAACuD,YAAJ,EAAoBvD,CAAG,CAACwD,WAFW,CAGzC1D,CAAI,CAAGhC,CAAU,CAAC8B,gBAAX,CAA4BC,CAA5B,CAHkC,CAI7C,GAAIC,CAAI,SAAJ,EAAsB,KAAK7B,IAAL,CAAU6B,CAAV,CAAtB,EAAuD,CAAd,CAAAA,CAAI,CAACxB,MAAlD,CAA8D,CAC1D,GAAImF,CAAAA,CAAM,CAAG3F,CAAU,CAACwC,iBAAX,EAAb,CACIoD,CAAU,CAAG5F,CAAU,CAACuD,qBAAX,EADjB,CAEIsC,CAAe,CAAGD,CAAU,CAAChC,MAAX,CAAkBkC,KAAlB,CAAwB,CAAC,EAAzB,CAFtB,CAGIC,CAAa,CAAGH,CAAU,CAAC/B,KAAX,CAAiBiC,KAAjB,CAAuB,CAAvB,CAA0B,EAA1B,CAHpB,CAOI9F,CAAU,CAACuE,YAAX,CAHc,WAAasB,CAAb,CACV,WADU,CACI7D,CADJ,CACW,YADX,CAC0B+D,CAD1B,CAC0C,UAExD,EAAqCC,EAArC,CAAwC,OAAxC,CAAiD,wBAAjD,CAAyE,UAAU,CAC/EhG,CAAU,CAAC4E,SAAX,EACH,CAFD,EAEGoB,EAFH,CAEM,OAFN,CAEe,oCAFf,CAEqD,UAAY,CAC7DhG,CAAU,CAAC4E,SAAX,EACH,CAJD,EAIGoB,EAJH,CAIM,OAJN,CAIe,yBAJf,CAIwC,UAAU,CAE9C,GAAIC,CAAAA,CAAQ,CAAG3G,CAAI,CAAC4G,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAG,4CADS,CAEtBC,IAAI,CAAE,CACF,IAAenE,MAAM,CAACoE,QAAP,CAAgBxE,QAAhB,EADb,CAEF,QAAeG,CAFb,CAGF,OAAc2D,CAHZ,CAIF,MAAiBE,CAJf,CAKF,IAAeE,CALb,CAMF,QAAe1G,CAAC,CAAC,IAAD,CAAD,CAAQiH,OAAR,CAAgB,uBAAhB,EAAyCC,IAAzC,CAA8C,yBAA9C,EAAuEC,GAAvE,EANb,CAFgB,CAAD,CAAV,CAAf,CAYAP,CAAQ,CAAC,CAAD,CAAR,CACKf,IADL,CACU,UAAU,CACZ1F,CAAY,CAACiH,UAAb,CAAwB,SAAxB,CAAmCzG,CAAU,CAACF,KAAX,CAAiB,gCAAjB,CAAnC,CACH,CAHL,EAIK4G,IAJL,CAIU,UAAU,CACZ,GAAIzE,MAAM,CAAC0E,OAAX,CAAoB,CAChBnH,CAAY,CAACiH,UAAb,CAAwB,MAAxB,CAAgCzG,CAAU,CAACF,KAAX,CAAiB,6BAAjB,CAAhC,CACH,CACJ,CARL,EAQO8G,MARP,CAQc,UAAY,CAClB5G,CAAU,CAAC4E,SAAX,EACH,CAVL,CAWH,CA7BD,CA8BP,CACJ,CACJ,CA3QE,CA4QHiC,YAAY,CAAE,sBAASjF,CAAT,CAAW,CACrB,GAAI5B,CAAAA,CAAU,CAAG,IAAjB,CACA,GAAiB,EAAb,EAAA4B,CAAC,CAAC2D,OAAN,CAAqB,CACjBvF,CAAU,CAAC4E,SAAX,EACH,CACJ,CAjRE,CAkRHkC,IAAI,CAAE,eAAW,CACb,GAAI9G,CAAAA,CAAU,CAAG,IAAjB,CAEAA,CAAU,CAAC8E,UAAX,GAHa,GAKTiC,CAAAA,CAAG,CAAG/G,CAAU,CAACoF,cAAX,CAA0B4B,IAA1B,CAA+BhH,CAA/B,CALG,CAMTiH,CAAG,CAAGjH,CAAU,CAAC6G,YAAX,CAAwBG,IAAxB,CAA6BhH,CAA7B,CANG,CAQbX,CAAC,CAAC8C,QAAD,CAAD,CACK+E,GADL,CACS,eADT,EAEKlB,EAFL,CAEQ,SAFR,CAEmBe,CAFnB,EAGKf,EAHL,CAGQ,OAHR,CAGiBiB,CAHjB,EAMA5H,CAAC,CAAC,QAAD,CAAD,CAAY8H,IAAZ,CAAiB,UAAU,CACvB9H,CAAC,CAAC,IAAD,CAAD,CAAQ2G,EAAR,CAAW,MAAX,CAAmB,UAAU,CAEzB,GAAI,KAAKoB,aAAT,CACA,CACI/H,CAAC,CAAC,KAAK+H,aAAL,CAAmBjF,QAApB,CAAD,CAA+B+E,GAA/B,CAAmC,eAAnC,EAAoDlB,EAApD,CAAuD,SAAvD,CAAkEe,CAAlE,EAAuEf,EAAvE,CAA0E,OAA1E,CAAmFiB,CAAnF,CACH,CACJ,CAND,EAQA,GAAI,KAAKG,aAAT,CACA,CACI/H,CAAC,CAAC,KAAK+H,aAAL,CAAmBjF,QAApB,CAAD,CAA+B+E,GAA/B,CAAmC,eAAnC,EAAoDlB,EAApD,CAAuD,SAAvD,CAAkEe,CAAlE,EAAuEf,EAAvE,CAA0E,OAA1E,CAAmFiB,CAAnF,CACH,CACJ,CAbD,EAeA,GAAiC,CAA7B,CAAA5H,CAAC,CAAC,gBAAD,CAAD,CAAoBmB,MAAxB,CACA,CAEI,GAAI6G,CAAAA,CAAQ,CAAG,GAAIC,CAAAA,gBAAJ,CAAqB,UAAW,CAC3CjI,CAAC,CAAC,uBAAD,CAAD,CAA2B8H,IAA3B,CAAgC,UAAU,CACtC9H,CAAC,CAAC,IAAD,CAAD,CAAQ2G,EAAR,CAAW,MAAX,CAAmB,UAAU,IAGrBuB,CAAAA,CAAM,CAAG,IAHY,CAMrBC,CAAO,CAAGC,WAAW,CAAC,UAAU,CAChC,GAAIF,CAAM,CAACH,aAAX,CACA,CACI/H,CAAC,CAACkI,CAAM,CAACH,aAAP,CAAqBjF,QAAtB,CAAD,CACK+E,GADL,CACS,eADT,EAEKlB,EAFL,CAEQ,SAFR,CAEmBe,CAFnB,EAGKf,EAHL,CAGQ,OAHR,CAGiBiB,CAHjB,CAIH,CACJ,CARwB,CAQtB,GARsB,CANA,CAiBzBS,UAAU,CAAC,UAAU,CAAEC,aAAa,CAACH,CAAD,CAAY,CAAtC,CAAwC,GAAxC,CACb,CAlBD,EAoBA,GAAI,KAAKJ,aAAT,CACA,CACI/H,CAAC,CAAC,KAAK+H,aAAL,CAAmBjF,QAApB,CAAD,CAA+B+E,GAA/B,CAAmC,eAAnC,EAAoDlB,EAApD,CAAuD,SAAvD,CAAkEe,CAAlE,EAAuEf,EAAvE,CAA0E,OAA1E,CAAmFiB,CAAnF,CACH,CACJ,CAzBD,CA0BH,CA3Bc,CAAf,CA4BAI,CAAQ,CAACO,OAAT,CAAiBvI,CAAC,CAAC,gBAAD,CAAD,CAAoBoE,GAApB,CAAwB,CAAxB,CAAjB,CAA6C,CACzCoE,OAAO,GADkC,CAEzCC,UAAU,GAF+B,CAGzCC,SAAS,GAHgC,CAIzCC,aAAa,GAJ4B,CAA7C,CAMH,CACJ,CArVE,CAuVV,CAxVK,CAAN","sourcesContent":["define(['jquery', 'core/ajax', 'core/str', 'theme_opentechnology/flashmessage'], function($, ajax, strman, flashmessage) {\n    return {\n        body: $('body'),\n        forbiddenTags: ['script', 'style', 'frame', 'iframe', 'meta', 'link', 'img'],\n        entityMap: {\"&\": \"&amp;\", \"<\": \"&lt;\", \">\": \"&gt;\", '\"': '&quot;', \"'\": '&#39;', \"/\": '&#x2F;'},\n        STRINGS: {\n            'spelling_mistake_modal_title': '...progress',\n            'spelling_mistake_modal_question_one': '...progress',\n            'spelling_mistake_modal_question_two': '...progress',\n            'spelling_mistake_modal_comment_placeholder': '...progress',\n            'spelling_mistake_modal_close': '...progress',\n            'spelling_mistake_modal_ok': '...progress',\n            'spelling_mistake_modal_success': '...progress',\n            'spelling_mistake_modal_fail': '...progress'\n        },\n        ORFOMODAL: null,\n\n        label: function (n) {\n            var CONTROLLER = this;\n            return CONTROLLER.STRINGS[n];\n        },\n        clearText: function(txt){\n            var CONTROLLER = this;\n            if (/\\S/.test(txt)) {\n                return txt.replace(/(\\r\\n|\\n|\\r)/gm, ' ').replace(/\\s+/g, ' ').replace(/[&<>\"'\\/]/g, function (s) {\n                    return CONTROLLER.entityMap[s];\n                });\n            }\n        },\n        extractTextFromNode: function(n){\n            var CONTROLLER = this;\n            for (var j = 0; j < CONTROLLER.forbiddenTags.length; j++) {\n                $(CONTROLLER.forbiddenTags[j], n).remove();\n            }\n            var nHtml = n.innerHTML.replace(/</gm, ' <');\n            var txt = (new DOMParser()).parseFromString(nHtml, 'text/html').body.innerText || '';\n            txt = txt.replace(/(\\n|\\r)/gm, ' ').replace(/^\\s+|\\s+$/g, '').replace(/\\s{2,}/g, ' ');\n            return txt;\n        },\n        extractTextFromRange: function(range){\n            var CONTROLLER = this;\n            var result = '';\n            try {\n                var clonedContent = range.cloneContents();\n                var nodes = clonedContent.children || clonedContent.childNodes;\n                var texts = [];\n                for (var i = 0, len = nodes.length; i < len; i++) {\n                    var txt = CONTROLLER.extractTextFromNode(nodes[i]);\n                    if (/\\S/.test(txt)) {\n                        texts.push(txt);\n                    }\n                }\n                result = texts.join(' ');\n            } catch(e) {\n                result = CONTROLLER.clearText(range.toString());\n            }\n            return result;\n        },\n        getSelectionText: function(win) {\n            var CONTROLLER = this;\n            var text = '';\n\n            if (win === undefined)\n            {\n                win = window;\n            }\n\n            var doc = win.document;\n\n            if (win.getSelection) {\n                text = win.getSelection().toString();\n            } else if (doc.selection && doc.selection.type != 'Control') {\n                text = doc.selection.createRange().text;\n            }\n            return CONTROLLER.clearText(text);\n        },\n        getSelectedPhrase: function(){\n            var CONTROLLER = this;\n            try{\n                var nodes = [], texts = [], selection;\n                if (window.getSelection) {\n                    selection = getSelection();\n                    for (var i = 0, len = selection.rangeCount; i < len; i++) {\n                        var rangeObj = selection.getRangeAt(i),\n                            startContainer = rangeObj.startContainer,\n                            endContainer = rangeObj.endContainer;\n                        if (startContainer) {\n                            nodes.push(startContainer.nodeName === \"#text\" ? startContainer.parentNode : startContainer);\n                        }\n                        if (endContainer) {\n                            nodes.push(endContainer.nodeName === \"#text\" ? endContainer.parentNode : endContainer);\n                        }\n                    }\n                    if (nodes.length === 0) {\n                        nodes = [selection.anchorNode];\n                    }\n                }\n                if (!nodes.length && document.selection) {\n                    selection = document.selection;\n                    var range = selection.getRangeAt ? selection.getRangeAt(0) : selection.createRange();\n                    var node = range.commonAncestorContainer ? range.commonAncestorContainer :\n                            range.parentElement ? range.parentElement() : range.item(0);\n                    if (node) {\n                        nodes = [node];\n                    }\n                }\n\n                for (var i = 0, nLen = nodes.length; i < nLen; i++) {\n                    var node = nodes[i];\n                    if (node.nodeName == \"#text\") {\n                        node = node.parentNode;\n                    }\n                    try {\n                        texts.push(CONTROLLER.extractTextFromNode(node.cloneNode()));\n                    } catch(e) {\n                        texts.push($(node).text());\n                    }\n                }\n                return texts.join(' ');\n            } catch (e) {\n            }\n        },\n        getAroundSelectedText: function(containerEl){\n            var CONTROLLER = this;\n            if (!containerEl) {\n                containerEl = CONTROLLER.body.get(0);\n            }\n            var sel, range, tempRange, before = \"\", after = \"\";\n            if (typeof window.getSelection != \"undefined\") {\n                sel = window.getSelection();\n                if (sel.rangeCount) {\n                    range = sel.getRangeAt(0);\n                } else {\n                    range = document.createRange();\n                    range.collapse(true);\n                }\n                tempRange = document.createRange();\n                tempRange.selectNodeContents(containerEl);\n                tempRange.setEnd(range.startContainer, range.startOffset);\n                before = CONTROLLER.extractTextFromRange(tempRange);\n\n                tempRange.selectNodeContents(containerEl);\n                tempRange.setStart(range.endContainer, range.endOffset);\n                after = CONTROLLER.extractTextFromRange(tempRange);\n            } else if ((sel = document.selection) && sel.type != \"Control\") {\n                range = sel.createRange();\n                tempRange = document.body.createTextRange();\n                tempRange.moveToElementText(containerEl);\n                tempRange.setEndPoint(\"EndToStart\", range);\n                before = CONTROLLER.clearText(tempRange.text || '');\n\n                tempRange.moveToElementText(containerEl);\n                tempRange.setEndPoint(\"StartToEnd\", range);\n                after = CONTROLLER.clearText(tempRange.text || '');\n            }\n\n            return {'before': before, 'after': after};\n        },\n        displayModal: function(drama){\n            var CONTROLLER = this;\n            var html = '<div class=\"opentechnology-modal moodle-has-zindex\" tabindex=\"-1\" style=\"display: block;\">'+\n                '<div class=\"opentechnology-modal-dialog moodle-has-zindex\">'+\n                  '<div class=\"opentechnology-modal-content\">'+\n                    '<div class=\"opentechnology-modal-header\">'+\n                      '<h2 class=\"opentechnology-modal-header-info\">' + CONTROLLER.label('spelling_mistake_modal_title') + '</h2>'+\n                      '<div class=\"opentechnology-modal-header-close moodle-has-zindex\"></div>'+\n                    '</div>'+\n                    '<div class=\"opentechnology-modal-body\">'+\n                        '<div class=\"opentechnology-modal-drama\">&laquo;' + drama + '&raquo;</div>'+\n                        '<div>' + CONTROLLER.label('spelling_mistake_modal_question_one') + '</div>'+\n                        '<input placeholder=\"' + CONTROLLER.label('spelling_mistake_modal_comment_placeholder') +\n                            '\" name=\"comment\" type=\"text\" style=\"margin-bottom:0 !important;\">'+\n                    '</div>'+\n                    '<div class=\"opentechnology-modal-footer\">'+\n                        '<button class=\"button btn btn-primary\" type=\"button\" role=\"submit\">'\n                            + CONTROLLER.label('spelling_mistake_modal_ok') + '</button>\\r\\n'+\n                        '<button class=\"button btn btn-primary\" type=\"button\" role=\"close\">'\n                            + CONTROLLER.label('spelling_mistake_modal_close') + '</button>\\r\\n'+\n                        '<div class=\"opentechnology-notice\">' + CONTROLLER.label('spelling_mistake_modal_question_two') + '</div>'+\n                    '</div>'+\n                '</div>'+\n            '</div>'+\n            '</div>'.replace(/(\\n|\\r|\\r\\n)/gm, '').replace(/\\s+/g, ' ');\n\n            CONTROLLER.ORFOMODAL = $(html);\n            CONTROLLER.body.addClass('opentechnology-modal-open').append(CONTROLLER.ORFOMODAL);\n            return CONTROLLER.ORFOMODAL;\n        },\n        hideModal: function(){\n            var CONTROLLER = this;\n            CONTROLLER.body.removeClass('opentechnology-modal-open');\n            if (CONTROLLER.ORFOMODAL && CONTROLLER.ORFOMODAL.length > 0) {\n                CONTROLLER.ORFOMODAL.remove();\n            }\n        },\n\n        setStrings: function() {\n            var CONTROLLER = this;\n\n            // получение языковых строк\n            strman.get_strings([\n                { key: 'spelling_mistake_modal_title', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_question_one', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_question_two', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_comment_placeholder', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_close', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_ok', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_success', component: 'theme_opentechnology' },\n                { key: 'spelling_mistake_modal_fail', component: 'theme_opentechnology' }\n            ]).done(function (strs) {\n\n                // установка языковых строк\n                CONTROLLER.STRINGS['spelling_mistake_modal_title'] = strs[0];\n                CONTROLLER.STRINGS['spelling_mistake_modal_question_one'] = strs[1];\n                CONTROLLER.STRINGS['spelling_mistake_modal_question_two'] = strs[2];\n                CONTROLLER.STRINGS['spelling_mistake_modal_comment_placeholder'] = strs[3];\n                CONTROLLER.STRINGS['spelling_mistake_modal_close'] = strs[4];\n                CONTROLLER.STRINGS['spelling_mistake_modal_ok'] = strs[5];\n                CONTROLLER.STRINGS['spelling_mistake_modal_success'] = strs[6];\n                CONTROLLER.STRINGS['spelling_mistake_modal_fail'] = strs[7];\n            });\n        },\n        keydownHandler: function(e){\n            var CONTROLLER = this;\n            if ((e.ctrlKey || e.metaKey) && e.keyCode == 13) {\n                var doc = e.currentTarget;\n                var win = doc.parentWindow || doc.defaultView;\n                var text = CONTROLLER.getSelectionText(win);\n                if (text !== undefined && /\\S/.test(text) && text.length > 1) {\n                    var phrase = CONTROLLER.getSelectedPhrase(),\n                        aroundText = CONTROLLER.getAroundSelectedText(),\n                        aroundTextStart = aroundText.before.slice(-50),\n                        aroundTextEnd = aroundText.after.slice(0, 50),\n                        previewText = '&hellip;' + aroundTextStart +\n                            ' <strong>' + text + '</strong> ' + aroundTextEnd + '&hellip;';\n\n                        CONTROLLER.displayModal(previewText).on('click', 'button[role=\"close\"]', function(){\n                            CONTROLLER.hideModal();\n                        }).on('click', '.opentechnology-modal-header-close', function () {\n                            CONTROLLER.hideModal();\n                        }).on('click', 'button[role=\"submit\"]', function(){\n\n                            var promises = ajax.call([{\n                                methodname : 'theme_opentechnology_send_spelling_mistake',\n                                args: {\n                                    'url'        : window.location.toString(),\n                                    'mistake'    : text,\n                                    'phrase'    : phrase,\n                                    'start'        : aroundTextStart,\n                                    'end'        : aroundTextEnd,\n                                    'comment'    : $(this).closest('.opentechnology-modal').find('input[name=\"comment\"]').val()\n                                }\n                            }]);\n\n                            promises[0]\n                                .done(function(){\n                                    flashmessage.addMessage('success', CONTROLLER.label('spelling_mistake_modal_success'));\n                                })\n                                .fail(function(){\n                                    if (window.console) {\n                                        flashmessage.addMessage('fail', CONTROLLER.label('spelling_mistake_modal_fail'));\n                                    }\n                                }).always(function () {\n                                    CONTROLLER.hideModal();\n                                });\n                        });\n                }\n            }\n        },\n        keyupHandler: function(e){\n            var CONTROLLER = this;\n            if (e.keyCode == 27) {\n                CONTROLLER.hideModal();\n            }\n        },\n        init: function() {\n            var CONTROLLER = this;\n\n            CONTROLLER.setStrings();\n\n            var kdh = CONTROLLER.keydownHandler.bind(CONTROLLER);\n            var kuh = CONTROLLER.keyupHandler.bind(CONTROLLER);\n\n            $(document)\n                .off('keydown keyup')\n                .on('keydown', kdh)\n                .on('keyup', kuh);\n\n            // добавление обработки нажатий внутри фреймов\n            $(\"iframe\").each(function(){\n                $(this).on('load', function(){\n                    // надеемся, что нет таких умных, которые меняют location.href в iframe, как scorm\n                    if (this.contentWindow)\n                    {\n                        $(this.contentWindow.document).off('keydown keyup').on('keydown', kdh).on('keyup', kuh);\n                    }\n                });\n                // событие может и не вызваться в случае, если контент добавлен не динамически\n                if (this.contentWindow)\n                {\n                    $(this.contentWindow.document).off('keydown keyup').on('keydown', kdh).on('keyup', kuh);\n                }\n            });\n\n            if ($('#scorm_content').length > 0)\n            {\n                // скорм умеет создавать DOM-элемент динамически, поэтому через mutation observer отлавливаем\n                var observer = new MutationObserver(function() {\n                    $(\"#scorm_content iframe\").each(function(){\n                        $(this).on('load', function(){\n                            // скорм реально подгружает документ через изменение location.href\n                            // отловить это изменение нельзя из-за секурности, поэтому таймер\n                            var iframe = this;\n\n                            // пытаемся навесить обработку каждые полсек\n                            var timerid = setInterval(function(){\n                                if (iframe.contentWindow)\n                                {\n                                    $(iframe.contentWindow.document)\n                                        .off('keydown keyup')\n                                        .on('keydown', kdh)\n                                        .on('keyup', kuh);\n                                }\n                            }, 500);\n\n                            // а через 5 сек останавливаем нашу деятельность\n                            setTimeout(function(){ clearInterval(timerid); }, 5000);\n                        });\n                        // событие может и не вызваться в случае, если контент добавлен не динамически\n                        if (this.contentWindow)\n                        {\n                            $(this.contentWindow.document).off('keydown keyup').on('keydown', kdh).on('keyup', kuh);\n                        }\n                    });\n                });\n                observer.observe($('#scorm_content').get(0), {\n                    subtree: true,\n                    attributes: true,\n                    childList: true,\n                    characterData: true\n                });\n            }\n        }\n    };\n});\n"],"file":"spellingmistake.min.js"}