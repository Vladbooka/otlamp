{"version":3,"sources":["../src/sticky.js"],"names":["define","$","elToStick","top","zindex","STICKY","is","addClass","css","newHeight","outerHeight","attr","find","length","get_initialised_dock","then","dock","stickMe","first","offset","document","scrollTop","stickyHeight","parent","parentResults","stickUpper","prevAll","not","get","reverse","each","res","stick","next","findNext","marginnext","results","nextMarginTop","parseInt","selector","window","resize","addEventListener","scroll","toggleClass","theme_opentechnology_handle_resize"],"mappings":"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","sourcesContent":["/* global get_initialised_dock */\n/* global theme_opentechnology_handle_resize */\ndefine(['jquery'], function($){\n    return {\n        'nextMarginTop': null,\n        'stickMe': function(elToStick, top, zindex) {\n            var STICKY = this;\n\n            if (!elToStick.is(\":visible\"))\n            {\n                return top;\n            }\n\n            elToStick.addClass('ot-sticky').addClass('moodle-has-zindex')\n                .css('top', top)\n                .css('z-index', zindex);\n            var newHeight = top + elToStick.outerHeight();\n\n            if (elToStick.attr('id') == 'dock_bg' || elToStick.find('#dock_bg').length > 0)\n            {\n                get_initialised_dock().then(function(dock){\n                    STICKY.stickMe($(dock), $('#dock_bg').first().offset().top - $(document).scrollTop(), zindex);\n                });\n            }\n\n            return newHeight;\n        },\n        'stickUpper': function(elToStick, stickyHeight, zindex){\n\n            var STICKY = this;\n\n            if (elToStick.parent().attr('id') != 'body-inner')\n            {\n                var parentResults = this.stickUpper(elToStick.parent(), stickyHeight, zindex);\n                stickyHeight = parentResults.stickyHeight;\n                zindex = parentResults.zindex;\n            }\n\n            $(elToStick.prevAll().not('script').not('style').get().reverse()).each(function() {\n                if ($(this).find('.dock_bg_wrapper').length > 0)\n                {\n                    // если прикрепляется нечто обрачивающее dock_bg_wrapper, надо начать прикреплять изнутри с dock_bg_wrapper,\n                    // чтобы не было проблем с zindex\n                    var res = STICKY.stick($('#page-header .dock_bg_wrapper'), stickyHeight, zindex--, false);\n                    stickyHeight = res.stickyHeight;\n                    zindex = res.zindex-1;\n                } else {\n                    stickyHeight = STICKY.stickMe($(this), stickyHeight, zindex--);\n                }\n            });\n\n            return {\n                stickyHeight: stickyHeight,\n                zindex: zindex\n            };\n        },\n        'findNext': function(elToStick){\n\n            var STICKY = this;\n\n            var next = elToStick.next();\n            if (next.length > 0)\n            {\n                return next;\n            } else\n            {\n                var parent = elToStick.parent();\n                if (parent.length > 0)\n                {\n                    return STICKY.findNext(parent);\n                } else\n                {\n                    return false;\n                }\n            }\n        },\n        'stick': function(elToStick, top, zindex, marginnext){\n\n            var STICKY = this;\n\n            var top = top || 0;\n            var zindex = zindex || 999;\n            var marginnext = marginnext || true;\n\n            var results = STICKY.stickUpper(elToStick, top, zindex);\n            var stickyHeight = STICKY.stickMe(elToStick, results.stickyHeight, results.zindex);\n\n            if (marginnext)\n            {\n                var next = STICKY.findNext(elToStick);\n                if (next)\n                {\n                    if (STICKY.nextMarginTop === null)\n                    {\n                        STICKY.nextMarginTop = parseInt(next.css('margin-top'));\n                    }\n                    next.css('margin-top', STICKY.nextMarginTop + stickyHeight);\n                }\n            }\n\n            return {\n                stickyHeight: stickyHeight,\n                zindex: results.zindex\n            };\n        },\n        'init': function(selector) {\n            var STICKY = this;\n            STICKY.stick($(selector));\n            $(window).resize(function(){\n                STICKY.stick($(selector));\n            });\n            document.addEventListener('DockItemsChanged', function (){\n                STICKY.stick($(selector));\n            }, false);\n            $(document).scroll(function(){\n                $('body').toggleClass('ot-sticky-scrolled', ($(document).scrollTop() > 0));\n            });\n            $('body').addClass('ot-sticky-enabled');\n            theme_opentechnology_handle_resize();\n        }\n    };\n});"],"file":"sticky.min.js"}