define ("theme_opentechnology/login",["jquery","core/str","core/yui","core/ajax","core/notification","core/templates"],function(a,b,c,d,e,f){return{defaultPageUrl:null,loginformDescription:"",dialogueContentReady:a.Deferred(),cleanModalRender:null,dialogue:a.Deferred(),cookiebtn:null,setCookieButton:function setCookieButton(a,b){var d=this;if(null===d.cookiebtn){d.cookiebtn=c.Node.create("<div></div>");a.addButton({srcNode:d.cookiebtn,action:function action(){},section:c.WidgetStdMod.HEADER});d.cookiebtn.replace(b)}},getDialogue:function getDialogue(){var a=this;if("resolved"!=a.dialogue.state()){c.use("moodle-core-notification",function(){var b=c.Node.create("<img />").setAttribute("src",M.util.image_url("i/loading","moodle")).addClass("spinner");a.dialogue.resolve(new M.core.dialogue({headerContent:"&nbsp;",bodyContent:c.Node.create("<div />").addClass("content-lightbox").append(b),draggable:!0,visible:!1,center:!0,modal:!0,width:"400px",extraClasses:["otloginform"]}))})}return a.dialogue.promise()},initDialogue:function initDialogue(b){var c=this;b.unbind("click").click(function(b){b.preventDefault();if(!localStorage.getItem("otJustRegistered")){var d=a(this).data("customPageurl");if(d){localStorage.setItem("otLoginWantsUrl",d)}else{localStorage.setItem("otLoginWantsUrl",c.defaultPageUrl)}}var e=a(this).data("loginformAlert");if(e){var f=a(this).data("loginformAlertType")||"info";e="<div class=\"alert alert-"+f+"\" role=\"alert\">"+e+"</div>"}else{e=""}c.dialogueContentReady.promise().done(function(b){b.set("bodyContent",e+c.cleanModalRender);a(".moodle-dialogue.otloginform .yui3-widget-buttons > .yui3-button:not(.closebutton)").remove();b.centered();b.show()})})},initRedirect:function initRedirect(a){var b=this;b.getDialogue().done(function(b){if(b.get("visible")){document.location.href="/login/"}else{a.unbind("click").click(function(){document.location.href="/login/"})}})},setDialogueContent:function setDialogueContent(a,b){var c=this;c.getDialogue().done(function(d){c.cleanModalRender=a;c.cleanCookieRender=b;d.set("bodyContent",a);c.setCookieButton(d,b);d.centered();if("resolved"!=c.dialogueContentReady.state()){c.dialogueContentReady.resolve(d)}})},setDialogueHeader:function setDialogueHeader(a){var b=this;b.getDialogue().done(function(b){b.set("headerContent",a)})},init:function init(e,g,h,i){var j=this;if(!i&&!localStorage.getItem("otJustRegistered")){localStorage.removeItem("otLoginWantsUrl")}j.defaultPageUrl=h;c.use("moodle-core-notification",function(){a(g).each(function(){j.initDialogue(a(this))})});var k=b.get_strings([{key:"ajaxpopup_loginheader",component:"theme_opentechnology"}]);a.when(k).done(function(a){j.setDialogueHeader(a[0])}).fail(function(){j.setDialogueHeader("\u0412\u0445\u043E\u0434")});var l=d.call([{methodname:"theme_opentechnology_get_login_form",args:{}}]);a.when(l[0]).done(function(b){var c=JSON.parse(b),d=f.render("theme_opentechnology/ot-loginform-modal",c),e=f.render("theme_opentechnology/ot-loginform-modal-cookie",c);a.when(d,e).done(function(a,b){j.setDialogueContent(a[0],b[0])}).fail(function(){j.initRedirect(a(g))})}).fail(function(){j.initRedirect(a(g))})}}});
//# sourceMappingURL=login.min.js.map
