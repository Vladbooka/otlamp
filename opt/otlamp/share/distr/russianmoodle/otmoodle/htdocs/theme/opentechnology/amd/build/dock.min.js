define ("theme_opentechnology/dock",["jquery","core/yui","core/templates","core/ajax","core/notification"],function(a,b,c,d,e){return{__itemsCount:0,dock:null,blockicons:{},courseid:null,pagetype:null,pagelayout:null,subpage:null,contextid:null,defaulticon:null,handleResize:function handleResize(){var a=0,c=b.one("#h_custommenu_wrapper label.custom_menu_mobile_label"),d=425<b.one("body").get("winWidth")?0:c?c.get("clientWidth"):0,e=b.one("#dock_bg"),f=b.one("body");if(0<d){if(null!==e){e.setStyle("padding-left",d+"px")}}else{if(null!==e){e.setStyle("padding-left",null)}}var g=b.one("#dock_bg h1"),h=b.one("#dock_bg .langmenu_wrapper"),i=b.one("#dock"),j=0,k=0,l=0,m=0;if(null!==e){j=e.getX()+parseFloat(e.getComputedStyle("paddingLeft"))-parseFloat(f.getComputedStyle("marginLeft"));k=e.getY();l=e.get("clientWidth")-parseFloat(e.getComputedStyle("paddingLeft"))-parseFloat(e.getComputedStyle("paddingRight"));m=e.get("clientHeight")}var n=0;if(null!==g){g.setStyle("display","inline-block");var n=g.get("clientWidth")}var o=0;if(null!==h){var o=h.get("clientWidth")}var p=b.one("html").getAttribute("data-dockeditem-title");if(null===p){p=0}if(2==parseInt(p)||4==parseInt(p)){var a=0;b.all("#dock .dockeditem").each(function(b){var c=b.one(".dockedtitle");if(2==parseInt(p)){c.removeClass("iconview");c.removeClass("texthide")}if(4==parseInt(p)){c.addClass("iconview");c.removeClass("texthide")}a+=b.get("clientWidth")});var q=l-n-(0<n?10:0)-o;if(q<a+10){a=0;b.all("#dock .dockeditem").each(function(b){var c=b.one(".dockedtitle");if(null!==c){if(!c.hasClass("noicon")){c.addClass("iconview");c.addClass("texthide")}}a+=b.get("clientWidth")})}}else{b.all("#dock .dockeditem").each(function(b){a+=b.get("clientWidth")})}var q=l-n-(0<n?10:0)-o;if(q<a+10){if(null!==g){g.setStyle("display","none")}n=0}var r=j+n+(0<n?10:0),s=l-n-(0<n?10:0)-o;if(i){if(f.hasClass("dir-rtl")){i.setStyle("right",r+o+"px")}else{i.setStyle("left",r+"px")}if(f.hasClass("ot-sticky-enabled")){if(i.hasClass("ot-sticky")){k=k-window.scrollY}else{if(null!==e){k=e.get("clientTop")}}}i.setStyle("top",k+"px");i.setStyle("width",s+"px");i.setStyle("height",m+"px")}},isDockHasItems:function isDockHasItems(){a("#page-header").toggleClass("dock-has-items",0<this.dock.find(".dockeditem").length)},hideItems:function hideItems(){this.dock.find("#dockeditempanel").addClass("dockitempanel_hidden");this.dock.find("#dockeditempanel .block").removeClass("active");this.dock.find(".buttons_container .dockeditem").removeClass("active");this.dock.find(".buttons_container .dockeditem .triangle").remove()},showItem:function showItem(b){b.addClass("active");var c=a("<div>").addClass("triangle").appendTo(b),d=this.dock.find("#dockeditempanel");d.removeClass("dockitempanel_hidden");this.dock.find("#dockeditempanel #"+b.attr("aria-controls")).addClass("active");var e=b.position().top+b.outerHeight()+10,f=this.dock.outerWidth()-(b.position().left+b.outerWidth());d.css({top:e+"px",right:f+"px",left:"auto","max-height":"calc(100vh - "+(this.dock.position().top+e)+"px)"});c.css({right:f+15+"px"});var g=d.offset().left;if(0>g){d.css("right",f+g)}},initItems:function initItems(){var b=this;a("#dock .block .action-menu-trigger").on({"show.bs.dropdown":function showBsDropdown(){a("#dock #dockeditempanel").css("min-height","300px")},"hide.bs.dropdown":function hideBsDropdown(){a("#dock #dockeditempanel").css("min-height","auto")}});a("#body-inner").click(function(c){var d=a(c.target);if(d.is("#dock #dockeditempanel")||0<d.parents("#dock #dockeditempanel").length){return}var e=null;if(d.is("#dock .buttons_container .dockeditem")){e=d}else{var f=d.parents("#dock .buttons_container .dockeditem");if(0<f.length){e=f.first()}}if(null!==e){var g=e.hasClass("active");b.hideItems();if(!g){b.showItem(e)}}else{b.hideItems()}});var c=b.dock.find(".buttons_container .dockeditem");c.addClass("ready");b.__itemsCount=c.length},setDockeditemIcon:function setDockeditemIcon(a,b){var c=this;if(c.blockicons.hasOwnProperty(b)&&c.blockicons[b].icon!==void 0){a.css({"background-image":"url("+c.blockicons[b].icon+")"})}else{a.css({"background-image":"url("+c.defaulticon+")"});c.blockicons[b].promise.then(function(b){a.css({"background-image":"url("+b+")"})})}},handleDroppedAndHit:function handleDroppedAndHit(b){var d=b.data.dock,e=a(b.detail.dragnode),f=a(b.detail.dropnode),g=f.data("blockregion");if(!g){g=f.parent().data("blockregion")}var h=d.dock.find("#dockeditempanel"),i=a(".buttons_container .dockeditem[aria-controls=\""+e.attr("id")+"\"]");if("dock"!=g){h.removeClass("ready-to-drop");d.hideItems();i.remove();d.isDockHasItems();d.handleResize()}else if(0==i.length){var j=["dockedtitle"],k=a("html").data("dockeditem-title");if(1==k||3==k){j.push("iconview");if(1==k){j.push("texthide")}}var l=e.attr("id").slice(4),m={itemnum:++d.__itemsCount,title:e.find(".card-title").html(),blockinstanceid:l,setting_dockeditemtitle:k};if(d.blockicons.hasOwnProperty(l)&&d.blockicons[l].icon!==void 0){m.icon=d.blockicons[l].icon}m.dockedtitleclasses=j.join(" ");var n=c.render("theme_opentechnology/dockeditem",m);a.when(n).done(function(b){h.removeClass("ready-to-drop");d.dock.find(".buttons_container .dockeditem_container").append(b);d.handleResize();var c=a(".buttons_container .dockeditem[aria-controls=\""+e.attr("id")+"\"]");if(!m.hasOwnProperty("icon")){d.setDockeditemIcon(c.children(".dockedtitle"),l)}c.addClass("ready").click();d.isDockHasItems();d.handleResize()}).fail(function(a){h.removeClass("ready-to-drop");window.console.log(a)})}else{h.removeClass("ready-to-drop");i.click();d.isDockHasItems();d.handleResize()}},handleDragStartedEarly:function handleDragStartedEarly(b){var c=b.data.dock;c.hideItems();a("#page-header").addClass("dock-has-items");c.handleResize();var f=c.dock.find("#dockeditempanel");f.addClass("ready-to-drop");var g=a("#dock .buttons_container"),h=g.position().top+g.outerHeight();f.css({top:h+"px",right:"0"});var i=a(b.detail.dragnode),j=i.attr("id").replace(/inst/i,"");if(!c.blockicons.hasOwnProperty(j)){c.blockicons[j]={promise:new Promise(function(a,b){d.call([{methodname:"theme_opentechnology_get_dock_icon",args:{courseid:c.courseid,pagelayout:c.pagelayout,pagetype:c.pagetype,subpage:c.subpage,contextid:c.contextid,blockinstanceid:j},fail:function fail(a){e.exception(a);b(a)},done:function done(b){var d=new Image;d.onload=function(){c.blockicons[j].icon=this.src;a(this.src)};d.src=b}}])})}}},handleDraggedOverDropTarget:function handleDraggedOverDropTarget(b){var c=a(b.detail.dragnode);if(0<c.parents("#dock").length){c.addClass("active")}},init:function init(b,c,d,e,f,g){this.courseid=b;this.pagetype=c;this.pagelayout=d;this.subpage=e;this.contextid=f;this.defaulticon=g;this.dock=a("#dock");a("body").addClass("has_dock").addClass("has_dock_top_horizontal");this.isDockHasItems();this.handleResize();this.initItems();a(window).on("block_drag_started_early",{dock:this},this.handleDragStartedEarly);a(window).on("block_dragged_over_drop_target",{dock:this},this.handleDraggedOverDropTarget);a(window).on("block_dropped_and_hit",{dock:this},this.handleDroppedAndHit);var h=new Image;h.src=this.defaulticon}}});
//# sourceMappingURL=dock.min.js.map
