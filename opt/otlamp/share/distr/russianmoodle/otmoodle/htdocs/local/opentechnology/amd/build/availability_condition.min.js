define ("local_opentechnology/availability_condition",["exports","jquery","core/templates","core/notification","core/ajax"],function(a,c,d,e,f){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;c=g(c);d=g(d);e=g(e);f=g(f);function g(a){return a&&a.__esModule?a:{default:a}}function h(a,b){return n(a)||m(a,b)||k(a,b)||j()}function j(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function k(a,b){if(!a)return;if("string"==typeof a)return l(a,b);var c=Object.prototype.toString.call(a).slice(8,-1);if("Object"===c&&a.constructor)c=a.constructor.name;if("Map"===c||"Set"===c)return Array.from(c);if("Arguments"===c||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(c))return l(a,b)}function l(a,b){if(null==b||b>a.length)b=a.length;for(var c=0,d=Array(b);c<b;c++){d[c]=a[c]}return d}function m(a,b){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(a)))return;var c=[],d=!0,e=!1,f=void 0;try{for(var g=a[Symbol.iterator](),h;!(d=(h=g.next()).done);d=!0){c.push(h.value);if(b&&c.length===b)break}}catch(a){e=!0;f=a}finally{try{if(!d&&null!=g["return"])g["return"]()}finally{if(e)throw f}}return c}function n(a){if(Array.isArray(a))return a}function o(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){o=function(a){return typeof a}}else{o=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return o(a)}function p(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(a){c(a);return}if(h.done){b(i)}else{Promise.resolve(i).then(d,e)}}function q(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var h=a.apply(b,c);function f(a){p(h,d,e,f,g,"next",a)}function g(a){p(h,d,e,f,g,"throw",a)}f(void 0)})}}var r=function(a,b){var g=(0,c.default)("#"+a),i=g.parent(),j=(0,c.default)("<div>").addClass("availability_condition_form").appendTo(i),k=null;g.hide();j.html("<div class=\"spinner-border text-info\" role=\"status\"><span class=\"sr-only\">Loading...</span></div>");var l=function(){var a=q(regeneratorRuntime.mark(function a(){var b,f,h,i,l,m;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return u().catch(e.default.exception);case 2:b=a.sent;b=JSON.parse(JSON.stringify(b));a.next=6;return v().catch(e.default.exception);case 6:f=a.sent;f=JSON.parse(JSON.stringify(f));h="local_opentechnology/ac_root";i={logicalgroups:Object.values(b),comparisonoperators:Object.values(f)};a.next=12;return d.default.render(h,i).catch(e.default.exception);case 12:l=a.sent;m=JSON.parse(g.val());k=(0,c.default)(l);p(m,k.children(".content")).finally(function(){j.html(k);n()});case 16:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),m=function(){var a=t(),b=JSON.stringify(a);g.val(b)},n=function(){(0,c.default)(".ac-item[data-type=\"logicalgroup\"] > legend button.add-item, .ac-root > legend button.add-item").off("click").on("click",function(){var a=(0,c.default)(this).closest(".ac-item[data-type=\"logicalgroup\"], .ac-root").children(".content"),b=(0,c.default)(this).data("code");switch((0,c.default)(this).data("type")){case"logicalgroup":u().then(function(c){c=JSON.parse(JSON.stringify(c));if(c.hasOwnProperty(b)){r(c[b]).then(function(b){b.appendTo(a);m();n()})}});break;case"comparisonoperator":v().then(function(c){c=JSON.parse(JSON.stringify(c));if(c.hasOwnProperty(b)){s(c[b]).then(function(b){b.appendTo(a);m();n()})}});break;}});(0,c.default)(".ac-item[data-type=\"comparisonoperator\"] > .content button.change-arg").off("click").on("click",function(){var a=(0,c.default)(this).data("code"),b=(0,c.default)(this).parents(".input-group");w().then(function(c){c=JSON.parse(JSON.stringify(c));if(!c.hasOwnProperty(a)){throw"unknown replacement type"}var d=c[a],e=b.find(".replacement-type");e.data("code",d.code);if(d.hasOwnProperty("icon")){e.html("<i class=\"icon fa fa-"+d.icon+" fa-fw\"></i>")}else{e.html(d.displayname)}b.find(".operator-arg").hide().filter("[data-replacement-code=\""+a+"\"]").show();m()})});(0,c.default)(".ac-item > legend button.remove-item").off("click").on("click",function(){(0,c.default)(this).closest(".ac-item").remove();m();if(""==(0,c.default)(".ac-root > .content").html()){(0,c.default)(".ac-root > legend").show()}});var a=(0,c.default)(".ac-item[data-type=\"comparisonoperator\"] > .content .operator-arg");a.off("change paste keyup").on("change paste keyup",function(){m()});if(""!=(0,c.default)(".ac-root > .content").html()){(0,c.default)(".ac-root > legend").hide()}},p=function(){var a=q(regeneratorRuntime.mark(function a(b,c){var d,f;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return u().catch(e.default.exception);case 2:d=a.sent;d=JSON.parse(JSON.stringify(d));a.next=6;return v().catch(e.default.exception);case 6:f=a.sent;f=JSON.parse(JSON.stringify(f));return a.abrupt("return",new Promise(function(a){c.html("");var e=Object.keys(b);if("object"!==o(b)||1!=e.length){throw"Every level of config should be an associative array (object) with one item only"}var g=e[0],h=b[g];g=g.toLowerCase();if(!Array.isArray(h)||0==h.length){throw"Config-level value must be presented as not empty sequenced array"}if(d.hasOwnProperty(g)){r(d[g]).then(function(b){var d=b.children(".content").first(),e=[];h.forEach(function(a){e.push(p(a,d))});Promise.all(e).then(function(){b.appendTo(c);a(!0)})})}else if(f.hasOwnProperty(g)){s(f[g],h).then(function(b){b.appendTo(c);a(!0)})}else{a(!1)}}));case 9:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),r=function(){var a=q(regeneratorRuntime.mark(function a(b){var f,g,h,i,j,k;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:a.next=2;return u().catch(e.default.exception);case 2:f=a.sent;f=JSON.parse(JSON.stringify(f));a.next=6;return v().catch(e.default.exception);case 6:g=a.sent;g=JSON.parse(JSON.stringify(g));h="local_opentechnology/ac_logical_group";i={logicalgroup:b,logicalgroups:Object.values(f),comparisonoperators:Object.values(g)};a.next=12;return d.default.render(h,i).catch(e.default.exception);case 12:j=a.sent;k=(0,c.default)(j);return a.abrupt("return",k);case 15:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),s=function(){var a=q(regeneratorRuntime.mark(function a(b,f){var g,j,k,l,n,o,p,q,s,t,u,v,x,y,z;return regeneratorRuntime.wrap(function(a){while(1){switch(a.prev=a.next){case 0:if("undefined"==typeof f){f=[]}b.arguments=[];g=0;case 3:if(!(g<b.argsnum)){a.next=20;break}j={index:g,value:g in f?f[g]:null};a.next=7;return w().catch(e.default.exception);case 7:k=a.sent;k=JSON.parse(JSON.stringify(k));l=/{([^\.^}]+)\.([^}]+)}/;n=l.exec(j.value);if(null!==n&&k.hasOwnProperty(n[1])){o=k[n[1]];if(o.properties.hasOwnProperty(n[2])){o.properties[n[2]].selected=!0}}else{o=k.string}o.current=!0;for(p=0,q=Object.entries(k);p<q.length;p++){s=h(q[p],2),t=s[0],u=s[1];k[t].propertiescount=Object.keys(u.properties).length;k[t].properties=Object.values(k[t].properties)}j.replacements=Object.values(k);j.currentreplacement=o;b.arguments.push(j);case 17:g++;a.next=3;break;case 20:v="local_opentechnology/ac_comparison_operator";x={comparisonoperator:b};a.next=24;return d.default.render(v,x).catch(e.default.exception);case 24:y=a.sent;z=(0,c.default)(y);return a.abrupt("return",z);case 27:case"end":return a.stop();}}},a)}));return function(){return a.apply(this,arguments)}}(),t=function(a){if("undefined"==typeof a){a=k.children(".content").children(".ac-item")}var b={};if(1==a.length){b[a.data("code")]=[];switch(a.data("type")){case"logicalgroup":a.children(".content").children(".ac-item").each(function(){var d=t((0,c.default)(this));b[a.data("code")].push(d)});break;case"comparisonoperator":a.children(".content").find(".input-group").sort(function(d,a){return(0,c.default)(d).data("index")-(0,c.default)(a).data("index")}).each(function(){var d=(0,c.default)(this).find(".replacement-type"),e=d.data("code"),f=(0,c.default)(this).find(".operator-arg[data-replacement-code=\""+e+"\"]");if("string"==e){b[a.data("code")].push(f.val())}else{b[a.data("code")].push("{"+e+"."+f.val()+"}")}});break;}}return b},u=function(){if("undefined"==typeof u.result){u.result=new Promise(function(a){var b=f.default.call([{methodname:"local_opentechnology_get_ac_logical_groups",args:[]}]);b[0].done(function(b){a(JSON.parse(b))})})}return u.result},v=function(){if("undefined"==typeof v.result){v.result=new Promise(function(a){var b=f.default.call([{methodname:"local_opentechnology_get_ac_comparison_operators",args:[]}]);b[0].done(function(b){a(JSON.parse(b))})})}return v.result},w=function(){if("undefined"==typeof w.result){w.result=new Promise(function(a){var c=f.default.call([{methodname:"local_opentechnology_get_ac_replacements",args:{contextid:b}}]);c[0].done(function(b){a(JSON.parse(b))})})}return w.result};l()};a.init=r});
//# sourceMappingURL=availability_condition.min.js.map
