{"version":3,"sources":["../src/custom_field_searcher.js"],"names":["define","$","Ajax","Templates","Str","processResults","selector","results","items","isArray","each","index","item","push","value","svalue","label","length","substring","transport","query","success","failure","promise","call","methodname","args","search","field","attr","page","perpage","then","promises","render","when","apply","get_string","toomanyresults","fail"],"mappings":"AAsBAA,OAAM,2CAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,gBAAxB,CAA0C,UAA1C,CAAD,CAAwD,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA6BC,CAA7B,CAAkC,CAK5F,MAA4D,CAExDC,cAAc,CAAE,wBAASC,CAAT,CAAmBC,CAAnB,CAA4B,CACxC,GAAIC,CAAAA,CAAK,CAAG,EAAZ,CACA,GAAIP,CAAC,CAACQ,OAAF,CAAUF,CAAV,CAAJ,CAAwB,CACpBN,CAAC,CAACS,IAAF,CAAOH,CAAP,CAAgB,SAASI,CAAT,CAAgBC,CAAhB,CAAsB,CAClCJ,CAAK,CAACK,IAAN,CAAW,CACPC,KAAK,CAAEF,CAAI,CAACG,MADL,CAEPC,KAAK,CAAuB,EAArB,CAAAJ,CAAI,CAACG,MAAL,CAAYE,MAAZ,CAA0BL,CAAI,CAACG,MAAL,CAAYG,SAAZ,CAAsB,CAAtB,CAAyB,EAAzB,EAA6B,KAAvD,CAA+DN,CAAI,CAACG,MAFpE,CAAX,CAIH,CALD,EAMA,MAAOP,CAAAA,CAEV,CATD,IASO,CACH,MAAOD,CAAAA,CACV,CACJ,CAhBuD,CAkBxDY,SAAS,CAAE,mBAASb,CAAT,CAAmBc,CAAnB,CAA0BC,CAA1B,CAAmCC,CAAnC,CAA4C,CAEnD,GAAIC,CAAAA,CAAO,CAAGrB,CAAI,CAACsB,IAAL,CAAU,CAAC,CACrBC,UAAU,CAAE,wCADS,CAErBC,IAAI,CAAE,CACFC,MAAM,CAAEP,CADN,CAEFQ,KAAK,CAAE3B,CAAC,CAACK,CAAD,CAAD,CAAYuB,IAAZ,CAAiB,MAAjB,CAFL,CAGFC,IAAI,CAAE,CAHJ,CAIFC,OAAO,GAJL,CAFe,CAAD,CAAV,CAAd,CAUAR,CAAO,CAAC,CAAD,CAAP,CAAWS,IAAX,CAAgB,SAASzB,CAAT,CAAkB,CAC9B,GAAI0B,CAAAA,CAAQ,CAAG,EAAf,CAEA,GAAI1B,CAAO,CAACU,MAAR,IAAJ,CAAgC,CAE5BhB,CAAC,CAACS,IAAF,CAAOH,CAAP,CAAgB,SAASI,CAAT,CAAgBC,CAAhB,CAAsB,CAClCqB,CAAQ,CAACpB,IAAT,CAAcV,CAAS,CAAC+B,MAAV,CAAiB,yDAAjB,CAA4EtB,CAA5E,CAAd,CACH,CAFD,EAKA,MAAOX,CAAAA,CAAC,CAACkC,IAAF,CAAOC,KAAP,CAAanC,CAAC,CAACkC,IAAf,CAAqBF,CAArB,EAA+BD,IAA/B,CAAoC,UAAW,CAClDX,CAAO,CAACd,CAAD,CAEV,CAHM,CAKV,CAZD,IAYO,CACH,MAAOH,CAAAA,CAAG,CAACiC,UAAJ,CAAe,gBAAf,CAAiC,mBAAjC,QAAsEL,IAAtE,CAA2E,SAASM,CAAT,CAAyB,CACvGjB,CAAO,CAACiB,CAAD,CAEV,CAHM,CAIV,CAEJ,CAtBD,EAsBGC,IAtBH,CAsBQjB,CAtBR,CAuBH,CArDuD,CAuD/D,CA5DK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Custom field sercher module.\n *\n * @package    crw_system_search\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/templates', 'core/str'], function($, Ajax, Templates, Str) {\n\n    /** @var {Number} Maximum number of users to show. */\n    var MAXITEMS = 10;\n\n    return /** @alias module:enrol_manual/form-user-selector */ {\n\n        processResults: function(selector, results) {\n            var items = [];\n            if ($.isArray(results)) {\n                $.each(results, function(index, item) {\n                    items.push({\n                        value: item.svalue,\n                        label: item.svalue.length > 40 ? item.svalue.substring(0, 40)+'...' : item.svalue\n                    });\n                });\n                return items;\n\n            } else {\n                return results;\n            }\n        },\n\n        transport: function(selector, query, success, failure) {\n\n            var promise = Ajax.call([{\n                methodname: 'crw_system_search_find_by_custom_field',\n                args: {\n                    search: query,\n                    field: $(selector).attr('name'),\n                    page: 0,\n                    perpage: MAXITEMS + 1\n                }\n            }]);\n\n            promise[0].then(function(results) {\n                var promises = [];\n\n                if (results.length <= MAXITEMS) {\n                    // Render the label.\n                    $.each(results, function(index, item) {\n                        promises.push(Templates.render('crw_system_search/form-custom-field-searcher-suggestion', item));\n                    });\n\n                    // Apply the label to the results.\n                    return $.when.apply($.when, promises).then(function() {\n                        success(results);\n                        return;\n                    });\n\n                } else {\n                    return Str.get_string('toomanyresults', 'crw_system_search', '>' + MAXITEMS).then(function(toomanyresults) {\n                        success(toomanyresults);\n                        return;\n                    });\n                }\n\n            }).fail(failure);\n        }\n    };\n});\n"],"file":"custom_field_searcher.min.js"}