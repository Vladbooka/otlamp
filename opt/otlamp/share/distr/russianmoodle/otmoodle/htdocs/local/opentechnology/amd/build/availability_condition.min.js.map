{"version":3,"sources":["../src/availability_condition.js"],"names":["init","elementId","contextid","setting","settingHolder","parent","settingForm","addClass","appendTo","form","hide","html","settingToForm","getLogicalGroups","catch","notification","exception","logicalgroups","JSON","parse","stringify","getComparisonOperators","comparisonoperators","templateName","templateData","Object","values","templates","render","response","config","val","configToForm","children","finally","addHandlers","formToSetting","formToConfig","jsonedConfig","off","on","content","closest","itemcode","data","then","hasOwnProperty","createLogicalGroupElement","group","createComparisonOperatorElement","operator","newcode","inputgroup","parents","getReplacements","replacements","replacement","typebtn","find","code","icon","displayname","filter","show","remove","args","Promise","resolve","configKeys","keys","length","toLowerCase","Array","isArray","groupcontent","first","promises","forEach","subconfig","push","all","logicalGroup","element","comparisonOperator","arguments","i","argsnum","arg","regex","m","exec","value","currentreplacement","properties","selected","string","current","entries","r","propertiescount","item","each","sort","a","b","replacementcode","prop","result","ajaxPromises","ajax","call","methodname","done","jsonResponse"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\nimport $ from 'jquery';\nimport templates from 'core/templates';\nimport notification from 'core/notification';\nimport ajax from 'core/ajax';\n\nexport const init = (elementId, contextid) => {\n\n    const setting = $('#'+elementId);\n    const settingHolder = setting.parent();\n    const settingForm = $('<div>').addClass('availability_condition_form').appendTo(settingHolder);\n    var form = null;\n\n    setting.hide();\n    settingForm.html('<div class=\"spinner-border text-info\" role=\"status\"><span class=\"sr-only\">Loading...</span></div>');\n\n    const settingToForm = async () => {\n        var logicalgroups = await getLogicalGroups().catch(notification.exception);\n        logicalgroups = JSON.parse(JSON.stringify(logicalgroups));\n        var comparisonoperators = await getComparisonOperators().catch(notification.exception);\n        comparisonoperators = JSON.parse(JSON.stringify(comparisonoperators));\n\n        var templateName = 'local_opentechnology/ac_root';\n        var templateData = {\n            'logicalgroups': Object.values(logicalgroups),\n            'comparisonoperators': Object.values(comparisonoperators),\n        };\n        var response = await templates.render(templateName, templateData).catch(notification.exception);\n\n        var config = JSON.parse(setting.val());\n        form = $(response);\n        configToForm(config, form.children('.content')).finally(() => {\n            settingForm.html(form);\n            addHandlers();\n        });\n    };\n\n    const formToSetting = function() {\n        var config = formToConfig();\n        var jsonedConfig = JSON.stringify(config);\n        setting.val(jsonedConfig);\n    };\n\n    const addHandlers = () => {\n        var rootOrGroup = '.ac-item[data-type=\"logicalgroup\"] > legend button.add-item, .ac-root > legend button.add-item';\n        $(rootOrGroup).off('click').on('click', function(){\n            var content = $(this).closest('.ac-item[data-type=\"logicalgroup\"], .ac-root').children('.content');\n            var itemcode = $(this).data('code');\n            switch ($(this).data('type')) {\n                case 'logicalgroup':\n                    getLogicalGroups().then(logicalgroups => {\n                        logicalgroups = JSON.parse(JSON.stringify(logicalgroups));\n                        if (logicalgroups.hasOwnProperty(itemcode)) {\n                            createLogicalGroupElement(logicalgroups[itemcode]).then(group => {\n                                group.appendTo(content);\n                                formToSetting();\n                                addHandlers();\n                            });\n                        }\n                    });\n                    break;\n                case 'comparisonoperator':\n                    getComparisonOperators().then(comparisonoperators => {\n                        comparisonoperators = JSON.parse(JSON.stringify(comparisonoperators));\n                        if (comparisonoperators.hasOwnProperty(itemcode)) {\n                            createComparisonOperatorElement(comparisonoperators[itemcode]).then(operator => {\n                                operator.appendTo(content);\n                                formToSetting();\n                                addHandlers();\n                            });\n                        }\n                    });\n                    break;\n            }\n        });\n\n        $('.ac-item[data-type=\"comparisonoperator\"] > .content button.change-arg').off('click').on('click', function(){\n            var newcode = $(this).data('code');\n            var inputgroup = $(this).parents('.input-group');\n            getReplacements().then(replacements => {\n                replacements = JSON.parse(JSON.stringify(replacements));\n                if (!replacements.hasOwnProperty(newcode)) {\n                    throw 'unknown replacement type';\n                }\n                var replacement = replacements[newcode];\n\n                var typebtn = inputgroup.find('.replacement-type');\n                typebtn.data('code', replacement.code);\n                if (replacement.hasOwnProperty('icon')) {\n                    typebtn.html('<i class=\"icon fa fa-'+replacement.icon+' fa-fw\"></i>');\n                } else {\n                    typebtn.html(replacement.displayname);\n                }\n\n                inputgroup.find('.operator-arg').hide().filter('[data-replacement-code=\"'+newcode+'\"]').show();\n\n                formToSetting();\n            });\n        });\n\n        $('.ac-item > legend button.remove-item').off('click').on('click', function(){\n            $(this).closest('.ac-item').remove();\n            formToSetting();\n            if ($('.ac-root > .content').html() == '') {\n                $('.ac-root > legend').show();\n            }\n        });\n\n        var args = $('.ac-item[data-type=\"comparisonoperator\"] > .content .operator-arg');\n        args.off('change paste keyup').on('change paste keyup', function(){\n            formToSetting();\n        });\n\n        if ($('.ac-root > .content').html() != '') {\n            $('.ac-root > legend').hide();\n        }\n    };\n\n    const configToForm = async (config, parent) => {\n        var logicalgroups = await getLogicalGroups().catch(notification.exception);\n        logicalgroups = JSON.parse(JSON.stringify(logicalgroups));\n        var comparisonoperators = await getComparisonOperators().catch(notification.exception);\n        comparisonoperators = JSON.parse(JSON.stringify(comparisonoperators));\n\n        return new Promise(resolve => {\n            parent.html('');\n\n            var configKeys = Object.keys(config);\n\n            if (typeof config !== 'object' || configKeys.length != 1) {\n                throw 'Every level of config should be an associative array (object) with one item only';\n            }\n\n            var code = configKeys[0];\n            var data = config[code];\n            code = code.toLowerCase();\n\n            if (!Array.isArray(data) || data.length == 0) {\n                throw 'Config-level value must be presented as not empty sequenced array';\n            }\n\n            if (logicalgroups.hasOwnProperty(code)) {\n                createLogicalGroupElement(logicalgroups[code]).then(group => {\n                    var groupcontent = group.children('.content').first();\n                    var promises = [];\n                    data.forEach(subconfig => {\n                        promises.push(configToForm(subconfig, groupcontent));\n                    });\n\n                    Promise.all(promises).then(() => {\n                        group.appendTo(parent);\n                        resolve(true);\n                    });\n                });\n            } else if (comparisonoperators.hasOwnProperty(code)) {\n                createComparisonOperatorElement(comparisonoperators[code], data).then(operator => {\n                    operator.appendTo(parent);\n                    resolve(true);\n                });\n            } else {\n                resolve(false);\n            }\n\n\n        });\n    };\n\n    const createLogicalGroupElement = async (logicalGroup) => {\n        var logicalgroups = await getLogicalGroups().catch(notification.exception);\n        logicalgroups = JSON.parse(JSON.stringify(logicalgroups));\n        var comparisonoperators = await getComparisonOperators().catch(notification.exception);\n        comparisonoperators = JSON.parse(JSON.stringify(comparisonoperators));\n        var templateName = 'local_opentechnology/ac_logical_group';\n        var templateData = {\n            'logicalgroup': logicalGroup,\n            'logicalgroups': Object.values(logicalgroups),\n            'comparisonoperators': Object.values(comparisonoperators),\n        };\n        var response = await templates.render(templateName, templateData).catch(notification.exception);\n        var element = $(response);\n        return element;\n    };\n\n    const createComparisonOperatorElement = async (comparisonOperator, data) => {\n\n        if (typeof data === 'undefined') {\n            data = [];\n        }\n\n        comparisonOperator.arguments = [];\n        for(var i = 0; i < comparisonOperator.argsnum; i++) {\n            var arg = {\n                'index': i,\n                'value': (i in data ? data[i] : null),\n            };\n\n            var replacements = await getReplacements().catch(notification.exception);\n            replacements = JSON.parse(JSON.stringify(replacements));\n\n            const regex = /{([^\\.^}]+)\\.([^}]+)}/;\n            let m = regex.exec(arg.value);\n            var currentreplacement;\n            if (m !== null && replacements.hasOwnProperty(m[1])) {\n                currentreplacement = replacements[m[1]];\n                if (currentreplacement.properties.hasOwnProperty(m[2])) {\n                    currentreplacement.properties[m[2]].selected = true;\n                }\n            } else {\n                currentreplacement = replacements.string;\n            }\n            currentreplacement.current = true;\n\n            for (const [r, replacement] of Object.entries(replacements)) {\n                replacements[r].propertiescount = Object.keys(replacement.properties).length;\n                replacements[r].properties = Object.values(replacements[r].properties);\n            }\n\n            arg.replacements = Object.values(replacements);\n            arg.currentreplacement = currentreplacement;\n            comparisonOperator.arguments.push(arg);\n        }\n\n        var templateName = 'local_opentechnology/ac_comparison_operator';\n        var templateData = {'comparisonoperator': comparisonOperator};\n        var response = await templates.render(templateName, templateData).catch(notification.exception);\n        var element = $(response);\n        return element;\n    };\n\n    const formToConfig = function(item) {\n\n        if (typeof item === 'undefined') {\n            item = form.children('.content').children('.ac-item');\n        }\n\n        var config = {};\n\n        if (item.length == 1) {\n            config[item.data('code')] = [];\n            switch(item.data('type')) {\n                case 'logicalgroup':\n                    item.children('.content').children('.ac-item').each(function(){\n                        var subconfig = formToConfig($(this));\n                        config[item.data('code')].push(subconfig);\n                    });\n                    break;\n                case 'comparisonoperator':\n                    item.children('.content').find('.input-group').sort(function (a, b) {\n                        return $(a).data('index') - $(b).data('index');\n                    }).each(function(){\n                        var typebtn = $(this).find('.replacement-type');\n                        var replacementcode = typebtn.data('code');\n                        var prop = $(this).find('.operator-arg[data-replacement-code=\"'+replacementcode+'\"]');\n                        if (replacementcode == 'string') {\n                            config[item.data('code')].push(prop.val());\n                        } else {\n                            config[item.data('code')].push('{'+replacementcode+'.'+prop.val()+'}');\n                        }\n\n                    });\n                    break;\n            }\n        }\n\n        return config;\n    };\n\n    const getLogicalGroups = () => {\n        if (typeof getLogicalGroups.result == 'undefined') {\n            getLogicalGroups.result = new Promise((resolve) => {\n                var ajaxPromises = ajax.call([{\n                    methodname: 'local_opentechnology_get_ac_logical_groups',\n                    args: [],\n                }]);\n                ajaxPromises[0].done(jsonResponse => {\n                    resolve(JSON.parse(jsonResponse));\n                });\n            });\n        }\n        return getLogicalGroups.result;\n    };\n\n    const getComparisonOperators = () => {\n        if (typeof getComparisonOperators.result == 'undefined') {\n            getComparisonOperators.result = new Promise((resolve) => {\n                var ajaxPromises = ajax.call([{\n                    methodname: 'local_opentechnology_get_ac_comparison_operators',\n                    args: [],\n                }]);\n                ajaxPromises[0].done(jsonResponse => {\n                    resolve(JSON.parse(jsonResponse));\n                });\n            });\n        }\n        return getComparisonOperators.result;\n    };\n\n    const getReplacements = () => {\n        if (typeof getReplacements.result == 'undefined') {\n            getReplacements.result = new Promise((resolve) => {\n                var ajaxPromises = ajax.call([{\n                    methodname : 'local_opentechnology_get_ac_replacements',\n                    args: {'contextid': contextid}\n                }]);\n                ajaxPromises[0].done(jsonResponse => {\n                    resolve(JSON.parse(jsonResponse));\n                });\n            });\n        }\n        return getReplacements.result;\n    };\n\n    settingToForm();\n};"],"file":"availability_condition.min.js"}