{"version":3,"sources":["../src/config.js"],"names":["define","$","ajax","notification","templates","str","__config_structure","__configured_views","restoreDefaults","self","call","methodname","args","fail","exception","done","init","saveConfig","yaml","getYaml","window","console","log","generateYamlFromConfig","obj","prop","spacescount","spaces","Array","join","hasOwnProperty","leftside","test","isArray","length","each","propkey","v","view","config","fieldsconfigyaml","fields","fld","fieldconfig","fieldconfigyaml","relationcode","fielddata","fieldcode","displayname","replace","entity","entitycode","findRelationInConfig","relation","field","findFieldInConfig","result","endfields","endfield","applyViewChanges","viewcode","viewcard","getViewByCode","oldconfig","Object","assign","find","val","filterform","filters","filterparams","checksSelector","fielditem","parent","first","data","fielddisplayname","oldfield","modifiers","template","push","children","relatedentityfields","relatedentityfield","addEditHandlers","editEntitySection","click","spinner","addClass","attr","append","off","viewtosave","parents","displayViews","show","html","applyConfig","fieldorig","f","relationorig","r","relsel","fc","cbxsel","relatedentityfieldorig","inputsel","entityfields","editView","hide","removeClass","getEntityByCode","render","then","js","replaceNodeContents","entities","e","getNextViewcode","max","displayAddView","addViewSection","callback","views","viewsSection","filter","toString","strLoading","get_string","when","response","decodedresponse","parseJSON","config_structure","configured_views"],"mappings":"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","sourcesContent":["define(['jquery', 'core/ajax', 'core/notification', 'core/templates', 'core/str'],\n    function($, ajax, notification, templates, str) {\n        return {\n           __config_structure: {},\n           __configured_views: {},\n           restoreDefaults: function(){\n               var self = this;\n               ajax.call([{\n                   methodname : 'local_otcontrolpanel_restore_default_config',\n                   args: [],\n                   fail: notification.exception,\n                   done: function() {\n                       self.init();\n                   },\n               }]);\n           },\n           saveConfig: function(){\n               var self = this;\n               var yaml = self.getYaml();\n               window.console.log(yaml);\n               ajax.call([{\n                   methodname : 'local_otcontrolpanel_save_config',\n                   args: {yaml: yaml},\n                   fail: notification.exception,\n                   done: function() {\n                       self.init();\n                   },\n               }]);\n           },\n           generateYamlFromConfig: function(obj, prop, spacescount){\n               var self = this;\n               var yaml = '';\n               var spaces = new Array(spacescount + 1).join(' ');\n               if (obj.hasOwnProperty(prop))\n               {\n                   var leftside = '';\n                   if (/^\\+?(0|[1-9]\\d*)$/.test(prop)){\n                       // нумернованный массив\n                       leftside = spaces+'- ';\n                   } else {\n                       // именованный массив\n                       leftside = spaces+prop+': ';\n                   }\n\n                   if (obj[prop] !== null && (Array.isArray(obj[prop]) || typeof obj[prop] === 'object'))\n                   {\n                       if (obj[prop].length == 0)\n                       {// пустой массив - отобразим на этой же строке короткую запись\n                           yaml += leftside+'{  }\\r\\n';\n                       } else {\n                           yaml += leftside+'\\r\\n';\n                           $.each(obj[prop], function(propkey){\n                               yaml += self.generateYamlFromConfig(obj[prop], propkey, spacescount+2);\n                           });\n                       }\n                   } else {\n                       yaml += leftside+obj[prop]+'\\r\\n';\n                   }\n               }\n               return yaml;\n           },\n           /* Собрать строку yaml-конфига из конфига, хранящегося в __configured_views */\n           getYaml: function(){\n               var self = this;\n               var yaml = '';\n               $.each(self.__configured_views, function(v, view){\n                   var config = view['view-config'];\n\n                   if (!config.hasOwnProperty('entitycode'))\n                   {\n                       return;\n                   }\n\n                   var fieldsconfigyaml = '';\n                   $.each(config.fields, function(fld, fieldconfig){\n                       var fieldconfigyaml = '';\n                       if (fieldconfig.hasOwnProperty('relationcode') &&\n                           fieldconfig.hasOwnProperty('fields'))\n                       {\n                           // ПОЛЕ СО СВЯЗЬЮ И НАСТРОЕННЫМИ ДЛЯ НЕГО ВЛОЖЕННЫМИ ПОЛЯМИ\n                           fieldconfigyaml += '    relationcode: '+fieldconfig.relationcode+'\\r\\n';\n                           if (fieldconfig.fields.length == 0){\n                               fieldconfigyaml += '    fields: {  }\\r\\n';\n                           } else {\n                               fieldconfigyaml += '    fields: \\r\\n';\n                               $.each(fieldconfig.fields, function(fld, fielddata){\n                                   fieldconfigyaml += '      - fieldcode: '+fielddata.fieldcode+'\\r\\n';\n\n                                   fieldconfigyaml += self.generateYamlFromConfig(fielddata, 'modifiers', 8);\n                                   fieldconfigyaml += self.generateYamlFromConfig(fielddata, 'template', 8);\n                                   fieldconfigyaml += self.generateYamlFromConfig(fielddata, 'filterparams', 8);\n\n                                   if (fielddata.hasOwnProperty('displayname') && fielddata.displayname)\n                                   {\n                                       fieldconfigyaml += '        displayname: '+fielddata.displayname+'\\r\\n';\n                                   }\n                               });\n                           }\n                       }\n                       else if(fieldconfig.hasOwnProperty('fieldcode')) {\n                           fieldconfigyaml += '    fieldcode: '+fieldconfig.fieldcode+'\\r\\n';\n                       }\n\n                       fieldconfigyaml += self.generateYamlFromConfig(fieldconfig, 'modifiers', 4);\n                       fieldconfigyaml += self.generateYamlFromConfig(fieldconfig, 'template', 4);\n                       fieldconfigyaml += self.generateYamlFromConfig(fieldconfig, 'filterparams', 4);\n\n                       // раньше мы не добавляли поля связанных таблиц если в них не было полей\n                       // теперь по умолчанию поля без полей показывают количество найденных записей\n                       if (fieldconfig.hasOwnProperty('displayname') && fieldconfig.displayname)\n                       {\n                           fieldconfigyaml = '    displayname: '+fieldconfig.displayname+'\\r\\n'+fieldconfigyaml;\n                       }\n                       fieldsconfigyaml += fieldconfigyaml.replace(/ {4}/, '  - ');\n                   });\n\n                   if (fieldsconfigyaml != '')\n                   {\n                       if (!config.hasOwnProperty('displayname') || !config.displayname)\n                       {\n                           config.displayname = view.entity['entity-displayname'];\n                       }\n                       yaml += '- displayname: ' + config.displayname+'\\r\\n';\n                       yaml += '  entitycode: ' + config.entitycode+'\\r\\n';\n\n                       yaml += self.generateYamlFromConfig(config, 'filterform', 2);\n                       yaml += self.generateYamlFromConfig(config, 'filters', 2);\n\n                       yaml += '  fields: \\r\\n';\n                       yaml += fieldsconfigyaml;\n                   }\n               });\n               return yaml;\n           },\n           findRelationInConfig: function(config, relationcode) {\n               var fields = [];\n               var relation = null;\n               if (config.hasOwnProperty('fields'))\n               {\n                   fields = config.fields;\n               }\n               $.each(fields, function(fld, field){\n                   if (field.hasOwnProperty('relationcode') && field.relationcode == relationcode)\n                   {\n                       relation = field;\n                       return;\n                   }\n               });\n               return relation;\n           },\n           findFieldInConfig: function(config, fieldcode, relationcode){\n               var self = this;\n               var result = null;\n               var endfields = [];\n               if (relationcode === undefined && config.hasOwnProperty('fields'))\n               {\n                   endfields = config.fields;\n               } else {\n                   var relation = self.findRelationInConfig(config, relationcode);\n                   if (relation && fieldcode === null)\n                   {\n                       return relation;\n                   }\n                   if (relation && relation.hasOwnProperty('fields'))\n                   {\n                       endfields = relation.fields;\n                   }\n               }\n\n               $.each(endfields, function(fld, endfield){\n                   if(endfield.hasOwnProperty('fieldcode') && endfield.fieldcode == fieldcode)\n                   {\n                       result = endfield;\n                       return;\n                   }\n               });\n               return result;\n           },\n           /* Принимает код редактируемой вкладки, собирает инфу из DOM и кладет в __configured_views */\n           applyViewChanges: function(viewcode) {\n               var self = this;\n               var viewcard = $('.view[data-view-code=\"'+viewcode+'\"]');\n               var view = self.getViewByCode(viewcode);\n               var oldconfig = Object.assign({}, view['view-config']);\n\n               var displayname = viewcard.find('.view-displayname').val();\n               view['view-displayname'] = displayname;\n               view['view-config']['displayname'] = displayname;\n\n               if (oldconfig.hasOwnProperty('filterform')) {\n                   view['view-config']['filterform'] = oldconfig.filterform;\n               }\n               if (oldconfig.hasOwnProperty('filters')) {\n                   view['view-config']['filters'] = oldconfig.filters;\n               }\n               if (oldconfig.hasOwnProperty('filterparams')) {\n                   view['view-config']['filterparams'] = oldconfig.filterparams;\n               }\n\n               var fields = view['view-config']['fields'] = [];\n               var checksSelector = ' > .entity-fields > .field > input[type=\"checkbox\"]:checked';\n\n               viewcard.find('.entity'+checksSelector).each(function(){\n                   var fielditem = $(this).parent('.field').first();\n                   var field = {fieldcode: fielditem.data('field-code')};\n                   var fielddisplayname = fielditem.find('.field-displayname').val();\n                   if (fielddisplayname)\n                   {\n                       field.displayname = fielddisplayname;\n                   }\n                   var oldfield = self.findFieldInConfig(oldconfig, field.fieldcode);\n                   if (oldfield && oldfield.hasOwnProperty('modifiers'))\n                   {\n                       field.modifiers = oldfield.modifiers;\n                   }\n                   if (oldfield && oldfield.hasOwnProperty('template'))\n                   {\n                       field.template = oldfield.template;\n                   }\n                   fields.push(field);\n               });\n\n               viewcard.find('.entity-relation').each( function(){\n                   var relation = $(this);\n                   if (relation.children('input[type=checkbox]:checked').length == 0)\n                   {\n                       // данное поле со связанной сущностью не помечено, как необходимое для отображения\n                       // раньше отображали все с полями, теперь без полей - значит отобразить количество строк\n                       // не помечено - пропускаем\n                       return;\n                   }\n                   var relatedentityfields = [];\n                   relation.find('.relation-relatedentity'+checksSelector).each(function(){\n                       var fielditem = $(this).parent('.field').first();\n\n                       var relatedentityfield = {\n                           fieldcode: fielditem.data('field-code')\n                       };\n                       var fielddisplayname = fielditem.find('.field-displayname').val();\n                       if (fielddisplayname)\n                       {\n                           relatedentityfield.displayname = fielddisplayname;\n                       }\n\n                       // полям связанной таблицы тоже можно настраивать шаблоны и модификаторы\n                       var oldfield = self.findFieldInConfig(\n                           oldconfig,\n                           relatedentityfield.fieldcode,\n                           relation.data('relation-code')\n                       );\n                       if (oldfield && oldfield.hasOwnProperty('modifiers'))\n                       {\n                           relatedentityfield.modifiers = oldfield.modifiers;\n                       }\n                       if (oldfield && oldfield.hasOwnProperty('template'))\n                       {\n                           relatedentityfield.template = oldfield.template;\n                       }\n\n                       relatedentityfields.push(relatedentityfield);\n                   });\n\n                   var field = {\n                       relationcode: relation.data('relation-code'),\n                       fields: relatedentityfields,\n                   };\n\n                   var oldfield = self.findFieldInConfig(oldconfig, null, field.relationcode);\n                   if (oldfield && oldfield.hasOwnProperty('modifiers'))\n                   {\n                       field.modifiers = oldfield.modifiers;\n                   }\n                   if (oldfield && oldfield.hasOwnProperty('template'))\n                   {\n                       field.template = oldfield.template;\n                   }\n                   // для полей связанных таблиц есть возможность прокинуть параметры фильтрации в\n                   // связанную с полем сущность - сохраним эту возможность\n                   if (oldfield && oldfield.hasOwnProperty('filterparams'))\n                   {\n                       field.filterparams = oldfield.filterparams;\n                   }\n\n                   var fielddisplayname = relation.find('.relation-displayname').val();\n                   if (fielddisplayname)\n                   {\n                       field.displayname = fielddisplayname;\n                   }\n                   fields.push(field);\n               });\n\n               // сохранить конфиг\n               // по результату будет запущена полная инициализация, всё с нуля перерисуется\n               self.saveConfig();\n           },\n           /* После рендера блока редактирования навешивет нужные события,\n            * чтобы все изменения сохранялись в __configured_views */\n           addEditHandlers: function(editEntitySection){\n               var self = this;\n\n               editEntitySection.find('.save-view-config').click(function(){\n                   var spinner = $('<span>')\n                       .addClass('spinner-grow')\n                       .addClass('spinner-grow-sm')\n                       .attr('status', 'status')\n                       .attr('aria-hidden', 'true');\n                   $(this).append(spinner).attr('disabled', 'disabled').off('click');\n                   var viewtosave = $(this).parents('.view').first();\n                   self.applyViewChanges(viewtosave.data('view-code'));\n               });\n               editEntitySection.find('.cancel-view-config').click(function(){\n                   self.displayViews();\n                   $('.otcontrolpanel_config .add-view-section').show();\n                   $('.otcontrolpanel_config .edit-view-section').html('').show();\n               });\n           },\n           /* После рендера блока редактирования с потенциально возможными настройками,\n            * отмечает и заполняет те поля, которые уже сохранены в конфиге __configured_views */\n           applyConfig: function(editEntitySection){\n               var self = this;\n               $.each(self.__configured_views, function(v, view){\n                   var viewcode = view['view-code'];\n                   var config = view['view-config'];\n                   var entitycode = config['entitycode'];\n\n                   var viewcard = editEntitySection.find('.view[data-view-code=\"'+viewcode+'\"]');\n\n                   if (viewcard.find('.entity').data('entity-code') != entitycode)\n                   {\n                       return;\n                   }\n\n                   // название вкладки\n                   if (!config.hasOwnProperty('displayname') || !config.displayname)\n                   {\n                       config.displayname = view.entity['entity-displayname'];\n                   }\n                   viewcard.find('.view-displayname').val(config.displayname);\n\n                   $.each(config.fields, function(fld, fieldconfig){\n\n                       var fieldorig = null;\n                       $.each(view.entity['entity-fields'], function(f, field){\n                           if (field['field-code'] == fieldconfig.fieldcode)\n                           {\n                               fieldorig = field;\n                           }\n                       });\n                       if (!fieldconfig.hasOwnProperty('displayname') || !fieldconfig.displayname)\n                       {\n                           if (fieldorig)\n                           {\n                               fieldconfig.displayname = fieldorig['field-displayname'];\n                           } else {\n                               fieldconfig.displayname = fieldconfig.fieldcode;\n                           }\n                       }\n                       if (fieldconfig.hasOwnProperty('relationcode'))\n                       {\n                           var relationorig = null;\n                           $.each(view.entity['entity-relations'], function(r, relation){\n                               if (relation['relation-code'] == fieldconfig.relationcode)\n                               {\n                                   relationorig = relation;\n                               }\n                           });\n\n                           var relsel = '.entity-relation[data-relation-code=\"'+fieldconfig.relationcode+'\"]';\n                           var relation = viewcard.find(relsel);\n                           if(!fieldconfig.hasOwnProperty('displayname') || !fieldconfig.displayname)\n                           {\n                               if (relationorig) {\n                                   fieldconfig.displayname = relationorig['relation-relatedentity']['entity-displayname'];\n                               } else {\n                                   fieldconfig.displayname = fieldconfig.relationcode;\n                               }\n                           }\n                           relation.find('.relation-displayname').val(fieldconfig.displayname);\n                           // раз связь в конфиге есть - значит она должна быть помечена,\n                           // чтобы сохранилась при обновлении конфига\n                           relation.children('input[type=checkbox]').prop('checked', true);\n\n\n                           $.each(fieldconfig.fields, function(fc, fielddata){\n                               var cbxsel = '.field[data-field-code=\"'+fielddata.fieldcode+'\"] > input[type=\"checkbox\"]';\n                               relation.find(cbxsel).prop('checked', true);\n\n\n                               var relatedentityfieldorig = null;\n                               var relatedentityfields = relationorig['relation-relatedentity']['entity-fields'];\n                               $.each(relatedentityfields, function(f, field){\n                                   if (field['field-code'] == fielddata.fieldcode)\n                                   {\n                                       relatedentityfieldorig = field;\n                                   }\n                               });\n\n                               if (!fielddata.hasOwnProperty('displayname') || !fielddata.displayname)\n                               {\n                                   if (relatedentityfieldorig)\n                                   {\n                                       fielddata.displayname = relatedentityfieldorig['field-displayname'];\n                                   } else {\n                                       fielddata.displayname = fielddata.fieldcode;\n                                   }\n                               }\n                               var inputsel = '.field[data-field-code=\"'+fielddata.fieldcode+'\"] > .field-displayname';\n                               relation.find(inputsel).val(fielddata.displayname);\n                           });\n                       } else {\n                           var entityfields = viewcard.find('.entity > .entity-fields');\n                           var cbxsel = '.field[data-field-code=\"'+fieldconfig.fieldcode+'\"] > input[type=\"checkbox\"]';\n                           entityfields.find(cbxsel).prop('checked', true);\n                           var inputsel = '.field[data-field-code=\"'+fieldconfig.fieldcode+'\"] > .field-displayname';\n                           entityfields.find(inputsel).val(fieldconfig.displayname);\n                       }\n                   });\n               });\n           },\n           /* Рендерит блок редактирования для указанной вкладки,\n            * вызывает навешивание событий редактирования и заполнение текущим состоянием конфига */\n           editView: function(viewcode)\n           {\n               var self = this;\n\n               $('.otcontrolpanel_config .add-view-section').hide();\n\n               var spinner = $('.otcontrolpanel_config .views-section .views li[data-view-code=\"'+viewcode+'\"] .spinner');\n               spinner.removeClass('d-none').addClass('d-inline-block');\n               var view = self.getViewByCode(viewcode);\n               if (!view.hasOwnProperty('entity'))\n               {\n                   view.entity = self.getEntityByCode(view['view-config']['entitycode']);\n               }\n               if (!view['view-config'].hasOwnProperty('displayname'))\n               {\n                   view['view-config']['displayname'] = view['view-displayname'];\n               }\n\n               templates.render('local_otcontrolpanel/config-edit-view', {'view': view})\n                   .then(function(html, js) {\n                       var editEntitySection = $('.otcontrolpanel_config .edit-view-section');\n                       editEntitySection.show();\n                       templates.replaceNodeContents(editEntitySection, html, js);\n                       $('.otcontrolpanel_config .views-section').hide();\n                       self.addEditHandlers(editEntitySection);\n                       self.applyConfig(editEntitySection);\n                   })\n                   .fail(notification.exception)\n                   .done(function(){ spinner.removeClass('d-inline-block').addClass('d-none'); });\n           },\n           /* Находит и возвращает вкладку по коду в __configured_views\n            * Если не находит, возвращает null */\n           getViewByCode: function(viewcode){\n               var self = this;\n               var result = null;\n               $.each(self.__configured_views, function(v, view){\n                   if(view['view-code'] == viewcode)\n                   {\n                       result = view;\n                       return;\n                   }\n               });\n               return result;\n           },\n           /* Находит по коду сущность в __config_structure и возвращает её\n            * Если не находит возвращает null\n            * Нужно чтобы получить все возможные варианты настроек/полей */\n           getEntityByCode: function(entitycode){\n               var self = this;\n               var result = null;\n               $.each(self.__config_structure.entities, function(e, entity){\n                   if(entity['entity-code'] == entitycode)\n                   {\n                       result = entity;\n                       return;\n                   }\n               });\n               return result;\n           },\n           /* Возвращает следующий порядковый номер вкладки */\n           getNextViewcode: function(){\n               var self = this;\n               var max = 0;\n               $.each(self.__configured_views, function(v, view){\n                   if (view['view-code'] > max)\n                   {\n                       max = view['view-code'];\n                   }\n               });\n               return max + 1;\n           },\n           /* Рендерит блок добавления новой вкладки, обрабатывает добавление */\n           displayAddView: function(){\n               var self = this;\n\n               templates.render('local_otcontrolpanel/config-add-view', {entities: self.__config_structure.entities})\n                   .then(function(html, js) {\n                       var addViewSection = $('.otcontrolpanel_config .add-view-section');\n                       templates.replaceNodeContents(addViewSection, html, js);\n\n                       addViewSection.show();\n                       addViewSection.find('input[type=\"button\"]').click(function(){\n                           var entitycode = addViewSection.find('select option:selected').val();\n                           var entity = self.getEntityByCode(entitycode);\n                           var viewcode = self.getNextViewcode();\n                           self.__configured_views.push({\n                               'view-code': viewcode,\n                               'view-config': {\n                                   'entitycode': entity['entity-code'],\n                                   'displayname': entity['entity-displayname'],\n                                   'fields': []\n                               },\n                               'view-displayname': entity['entity-displayname']\n                           });\n                           self.displayViews(function(){\n                               self.editView(viewcode);\n                           });\n                       });\n                   })\n                   .fail(notification.exception);\n           },\n           /* Отображает список настроенных вкладок, навешивае запуск редактирования по клику */\n           displayViews: function(callback) {\n               var self = this;\n\n               $.each(self.__configured_views, function(v, view){\n                   view['fields-count'] = view['view-config'].fields.length;\n               });\n\n               window.console.log(self.__configured_views);\n\n               templates.render('local_otcontrolpanel/config-views-list', {views: self.__configured_views})\n                   .then(function(html, js) {\n                       var viewsSection = $('.otcontrolpanel_config .views-section');\n                       viewsSection.show();\n                       templates.replaceNodeContents(viewsSection, html, js);\n                       viewsSection.find('.views > li')\n                           .filter(function(){\n                               return $(this).data('view-edit-disabled') != 1;\n                           }).click(function(){\n                               self.editView($(this).data('view-code'));\n                           });\n                       viewsSection.find('.restore-default-config').click(function(){\n                           var spinner = $('<span>')\n                               .addClass('spinner-grow')\n                               .addClass('spinner-grow-sm')\n                               .attr('status', 'status')\n                               .attr('aria-hidden', 'true');\n                           $(this).append(spinner).attr('disabled', 'disabled').off('click');\n                           self.restoreDefaults();\n                       });\n                       if (callback && {}.toString.call(callback) === '[object Function]')\n                       {\n                           callback();\n                       }\n                   })\n                   .fail(notification.exception);\n           },\n           /* получение конфига через аякс и инициализация всех остальных механизмов */\n           init: function() {\n               var self = this;\n\n               $('.otcontrolpanel_config .views-section').html('').show();\n               $('.otcontrolpanel_config .add-view-section').html('').show();\n               $('.otcontrolpanel_config .edit-view-section').html('').show();\n\n               var strLoading = str.get_string('config_is_loading', 'local_otcontrolpanel');\n               $.when(strLoading).done(function(strLoading){\n                   $('.otcontrolpanel_config .views-section').html(strLoading);\n                   ajax.call([{\n                       methodname : 'local_otcontrolpanel_get_config_data',\n                       args: [],\n                       fail: notification.exception,\n                       done: function(response) {\n                           var decodedresponse = $.parseJSON(response);\n                           self.__config_structure = decodedresponse.config_structure;\n                           self.__configured_views = decodedresponse.configured_views;\n                           self.displayViews();\n                           self.displayAddView();\n                       },\n                   }]);\n               });\n           }\n       };\n    }\n);\n"],"file":"config.min.js"}