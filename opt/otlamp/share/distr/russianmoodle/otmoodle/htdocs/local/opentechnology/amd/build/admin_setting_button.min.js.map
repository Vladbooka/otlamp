{"version":3,"sources":["../src/admin_setting_button.js"],"names":["define","$","notification","templates","ModalFactory","Y","_dialogues","_composeDialogueObject","id","dialogue","get","result","Deferred","resolve","promise","setContent","content","done","set","centered","setHeader","header","addClass","classname","show","hide","getDialogue","ASB","use","spinner","Node","create","setAttribute","M","util","image_url","core","headerContent","bodyContent","append","draggable","visible","center","modal","width","initAndRender","dialogue_header","template_data","template_fullname","init","DObj","render","then","html","js","replaceNodeContents","fail","ex","alert","message","unbind","click","e","preventDefault","removeAttr","on","event","data","val","JSON","stringify"],"mappings":"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","sourcesContent":["define(['jquery', 'core/notification', 'core/templates', 'core/modal_factory', 'core/yui'],\n        function($, notification, templates, ModalFactory, Y) {\n\n    return {\n        _dialogues: [],\n\n        _composeDialogueObject: function(id, dialogue){\n            return {\n                id: id,\n                dialogue: dialogue,\n                get: function(){\n                    var result = $.Deferred();\n                    result.resolve(this.dialogue);\n                    return result.promise();\n                },\n                setContent: function(content) {\n                    var result = $.Deferred();\n                    var promise = this.get();\n                    promise.done(function(dialogue){\n                        dialogue.set('bodyContent', content);\n                        dialogue.centered();\n                        result.resolve();\n                    });\n                    return result.promise();\n                },\n                setHeader: function(header) {\n                    var result = $.Deferred();\n                    var promise = this.get();\n                    promise.done(function(dialogue){\n                        dialogue.set('headerContent', header);\n                        dialogue.centered();\n                        result.resolve();\n                    });\n                    return result.promise();\n                },\n                addClass: function(classname) {\n                    var result = $.Deferred();\n                    var promise = this.get();\n                    promise.done(function(dialogue){\n                        dialogue.get('boundingBox').addClass(classname);\n                        result.resolve();\n                    });\n                    return result.promise();\n                },\n                show: function() {\n                    var result = $.Deferred();\n                    var promise = this.get();\n                    promise.done(function(dialogue){\n                        dialogue.show();\n                        result.resolve();\n                    });\n                    return result.promise();\n                },\n                hide: function() {\n                    var result = $.Deferred();\n                    var promise = this.get();\n                    promise.done(function(dialogue){\n                        dialogue.hide();\n                        result.resolve();\n                    });\n                    return result.promise();\n                }\n            };\n        },\n\n        getDialogue: function(id) {\n\n            var ASB = this;\n\n            if (!(id in ASB._dialogues)) {\n                ASB._dialogues[id] = $.Deferred();\n\n                Y.use('moodle-core-notification', function() {\n\n                    var spinner = Y.Node.create('<img />')\n                        .setAttribute('src', M.util.image_url('i/loading', 'moodle'))\n                        .addClass('spinner');\n\n                    var dialogue = new M.core.dialogue({\n                        headerContent: '&nbsp;',\n                        bodyContent: Y.Node.create('<div />').addClass('content-lightbox').append(spinner),\n                        draggable: true,\n                        visible: false,\n                        center: true,\n                        modal: true,\n                        width: '500px',\n                    });\n\n                    ASB._dialogues[id].resolve(ASB._composeDialogueObject(id, dialogue));\n\n                });\n            }\n\n            return ASB._dialogues[id].promise();\n        },\n\n        initAndRender: function(id, dialogue_header, template_data, template_fullname) {\n\n            var ASB = this;\n\n            var result = $.Deferred();\n\n            ASB.init(id, dialogue_header).done(function(DObj){\n\n\n                template_data['id'] = id;\n                templates.render(template_fullname, template_data)\n                    .then(function(html, js) {\n                        var content = $('<div>');\n                        templates.replaceNodeContents(content, html, js);\n                        DObj.setContent(content);\n                    }).fail(function(ex) {\n                        DObj.setContent('error');\n                        notification.alert(ex.message);\n                    });\n\n                result.resolve(DObj);\n            });\n\n            return result.promise();\n        },\n\n        init: function(id, dialogue_header) {\n            var ASB = this;\n\n            var result = $.Deferred();\n\n            ASB.getDialogue(id).done(function(DObj){\n\n                $('#'+id+'-button').unbind('click').click(function(e) {\n                    e.preventDefault();\n                    DObj.show();\n                }).removeAttr('disabled');\n\n                $('#'+id).on('readyToSave', function(event, data){\n                    $(this).val(JSON.stringify(data));\n                    DObj.hide();\n                });\n\n                DObj.setHeader(dialogue_header);\n\n                result.resolve(DObj);\n\n            });\n\n            return result.promise();\n        }\n    };\n});"],"file":"admin_setting_button.min.js"}