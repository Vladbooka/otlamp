define ("local_learninghistory/time_left",["jquery","core/ajax","core/templates"],function(a,b,c){return{_timer:null,_delay:null,_userid:null,_courseid:null,_totaltime:0,startRefresh:function startRefresh(){var a=this;a._timer=setInterval(function(){a._refreshTimer()},a._delay)},stopRefresh:function stopRefresh(){var a=this;clearInterval(a._timer)},_refreshTimer:function _refreshTimer(){var d=this,e=b.call([{methodname:"local_learninghistory_get_current_activetime",args:{userid:d._userid,courseid:d._courseid}}]);e[0].done(function(b){var e=a.parseJSON(b),f=d.getTimeRemaining(e.activetime),g;if(0<f.total||0===f.total&&0===d._totaltime){g=d.rusDateInterval(f)}else{clearInterval(d._timer);g="\u0412\u0440\u0435\u043C\u044F \u0432\u044B\u0448\u043B\u043E"}var h={activetimestr:g,atlastupdate:e.atlastupdate};c.render("local_learninghistory/timeleft",h).then(function(b,d){c.replaceNodeContents(a(".block.activetimer > .card-body > .card-text > .content"),b,d)})}).fail(function(a){window.console.log(a.message)})},getTimeRemaining:function getTimeRemaining(a){var b=this,c;if(0<b._totaltime){c=b._totaltime-a;if(0>c){c=0}}else{c=a}var d=Math.floor(c%60),e=Math.floor(c/60%60),f=Math.floor(c/3600%24),g=Math.floor(c/86400);return{total:c,days:g,hours:f,minutes:e,seconds:d}},rusDateInterval:function rusDateInterval(a){var b=this,c=[];if(0!==a.days){c.push(b.rusNum(a.days,["\u0434\u0435\u043D\u044C","\u0434\u043D\u044F","\u0434\u043D\u0435\u0439"]))}if(0!==a.hours){c.push(b.rusNum(a.hours,["\u0447\u0430\u0441","\u0447\u0430\u0441\u0430","\u0447\u0430\u0441\u043E\u0432"]))}if(0!==a.minutes){c.push(b.rusNum(a.minutes,["\u043C\u0438\u043D\u0443\u0442\u0430","\u043C\u0438\u043D\u0443\u0442\u044B","\u043C\u0438\u043D\u0443\u0442"]))}if(0===a.days&&0===a.hours&&0===a.minutes){c.push(b.rusNum(a.seconds,["\u0441\u0435\u043A\u0443\u043D\u0434\u0430","\u0441\u0435\u043A\u0443\u043D\u0434\u044B","\u0441\u0435\u043A\u0443\u043D\u0434"]))}return c.join(" ")},rusNum:function rusNum(a,b){if(1==a%10&&11!=a%100){return a+" "+b[0]}else if(2<=a%10&&4>=a%10&&(11>a%100||14<a%100)){return a+" "+b[1]}else{return a+" "+b[2]}},init:function init(b,c,d,e){this._delay=1e3*parseInt(b);if(isNaN(this._delay)||2e4>this._delay){this._delay=2e4}this._userid=d;this._courseid=e;this._totaltime=c;var f=this;f._refreshTimer();a(function(){f.startRefresh();a(window).blur(function(){f.stopRefresh()});a(window).focus(function(){f.startRefresh()})})}}});
//# sourceMappingURL=time_left.min.js.map
