{"version":3,"sources":["../src/ajax_filter_no_auth.js"],"names":["define","$","notification","ajax","templates","init","contextid","categoryid","submit","e","preventDefault","data","showcase","parents","addClass","params","formdata","serialize","jsonformdata","JSON","stringify","response","call","methodname","args","done","jsNodes","js","allScript","each","index","scriptNode","tagName","prop","toLowerCase","attr","exists","s","encodeURI","text","replaceNodeContents","get","html","always","removeClass","fail","ex","alert","message"],"mappings":"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","sourcesContent":["define(['jquery', 'core/notification', 'core/ajax', 'core/templates'],\n        function($, notification, ajax, templates) {\n    return {\n        /**\n         * Базовая инициализация ajax-загрузки\n         */\n        init: function(contextid, categoryid) {\n            $('#local_crw .crw_ptype_30 .crw_plugin_body form[data-ajax-filter=\"1\"]').submit(function(e){\n                e.preventDefault();\n\n                $(this).data('submit-state', 'submit');\n                if ($(this).data('submition-state') != 'submition')\n                {\n                    $(this).data('submition-state', 'submition');\n                    var showcase = $(this).parents('#local_crw');\n                    showcase.addClass('loading');\n                    var params = {\n                        'categoryid': categoryid,\n                        'splobjecthash': showcase.data('object-id')\n                    };\n                    var formdata = $(this).serialize();\n                    if (typeof formdata !== \"undefined\") {\n                        params.jsonformdata = JSON.stringify(formdata);\n                    }\n                    var response = ajax.call([ {\n                        methodname : 'crw_system_search_ajax_filter_no_auth',\n                        args : {\n                            'params' : JSON.stringify(params)\n                        }\n                    } ]);\n                    response[0]\n                            .done(function(data) {\n                                var jsNodes = $(data.js);\n                                var allScript = '';\n                                jsNodes.each(function(index, scriptNode) {\n                                    scriptNode = $(scriptNode);\n                                    var tagName = scriptNode.prop('tagName');\n                                    if (tagName && (tagName.toLowerCase() == 'script')) {\n                                        if (scriptNode.attr('src')) {\n                                            // We only reload the script if it was not loaded already.\n                                            var exists = false;\n                                            $('script').each(function(index, s) {\n                                                if ($(s).attr('src') == scriptNode.attr('src')) {\n                                                    exists = true;\n                                                }\n                                                return !exists;\n                                            });\n                                            if (!exists) {\n                                                allScript += ' { ';\n                                                allScript += ' node = document.createElement(\"script\"); ';\n                                                allScript += ' node.type = \"text/javascript\"; ';\n                                                allScript += ' node.src = decodeURI(\"' + encodeURI(scriptNode.attr('src')) + '\"); ';\n                                                allScript += ' document.getElementsByTagName(\"head\")[0].appendChild(node); ';\n                                                allScript += ' } ';\n                                            }\n                                        } else {\n                                            allScript += ' ' + scriptNode.text();\n                                        }\n                                    }\n                                });\n                                templates.replaceNodeContents(showcase.get(0), data.html, allScript);\n                            })\n                            .always(function(){\n                                showcase.removeClass('loading');\n                            })\n                            .fail(function(ex) {\n                                notification.alert(ex.message);\n                            });\n                }\n            });\n        }\n    };\n});"],"file":"ajax_filter_no_auth.min.js"}