{"version":3,"sources":["../src/table_controller.js"],"names":["define","$","ajax","Y","fragment","templates","N","init","document","ready","openedWindows","window","_open","open","url","name","params","push","quiz","quizid","length","find","val","attemptsTable","attemptsIds","each","refreshAttemptsData","requests","call","methodname","args","questionattemptsids","done","res","parseJSON","hasClass","attemptid","index","cells","html","addClass","removeClass","click","e","openpopup","attr","key","value","opener","timer","setInterval","checkFunction","close","closed","clearInterval","bind","splice","fail","exception","always","setTimeout","container","refreshCharts","loadFragment","js","css","outerHeight","replaceNodeContents","JSON","stringify"],"mappings":"AAsBAA,OAAM,oCACF,CAAC,QAAD,CAAU,WAAV,CAAuB,UAAvB,CAAmC,eAAnC,CAAoD,gBAApD,CAAsE,mBAAtE,CADE,CAEF,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAAqBC,CAArB,CAA+BC,CAA/B,CAA0CC,CAA1C,CAA4C,CACxC,MAAO,CACHC,IAAI,CAAE,eAAW,CACbN,CAAC,CAACO,QAAD,CAAD,CAAYC,KAAZ,CAAkB,UAAY,CAC1B,GAAIC,CAAAA,CAAa,CAAG,EAApB,CACAC,MAAM,CAACC,KAAP,CAAeD,MAAM,CAACE,IAAtB,CACAF,MAAM,CAACE,IAAP,CAAc,SAASC,CAAT,CAAaC,CAAb,CAAkBC,CAAlB,CAAyB,CACnCN,CAAa,CAACO,IAAd,CAAmBN,MAAM,CAACC,KAAP,CAAaE,CAAb,CAAiBC,CAAjB,CAAsBC,CAAtB,CAAnB,CACH,CAFD,CAH0B,GAOtBE,CAAAA,CAAI,CAAGjB,CAAC,CAAC,eAAD,CAPc,CAQtBkB,CAAM,CAAG,CARa,CAS1B,GAAkB,CAAd,CAAAD,CAAI,CAACE,MAAT,CAAqB,CACjBD,CAAM,CAAGD,CAAI,CAACG,IAAL,CAAU,gBAAV,EAA4BC,GAA5B,EACZ,CAXyB,GAYtBC,CAAAA,CAAa,CAAGtB,CAAC,CAAC,WAAD,CAZK,CAatBuB,CAAW,CAAG,EAbQ,CAc1B,GAA2B,CAAvB,CAAAD,CAAa,CAACH,MAAlB,CAA6B,CACzBG,CAAa,CAACF,IAAd,CAAmB,UAAnB,EAA+BI,IAA/B,CAAoC,UAAW,CAC3C,GAAIH,CAAAA,CAAG,CAAGrB,CAAC,CAAC,IAAD,CAAD,CAAQoB,IAAR,CAAa,yBAAb,EAAwCC,GAAxC,EAAV,CACA,GAAIA,CAAG,SAAP,CAAuB,CACnBE,CAAW,CAACP,IAAZ,CAAiBK,CAAjB,CACH,CACJ,CALD,CAMH,CAED,GAAII,CAAAA,CAAmB,CAAG,UAAW,CACjC,GAAIC,CAAAA,CAAQ,CAAGzB,CAAI,CAAC0B,IAAL,CAAU,CAAC,CACtBC,UAAU,CAAG,mCADS,CAEtBC,IAAI,CAAE,CAAEX,MAAM,CAAEA,CAAV,CAAkBY,mBAAmB,CAAEP,CAAvC,CAFgB,CAAD,CAAV,CAAf,CAIAG,CAAQ,CAAC,CAAD,CAAR,CACKK,IADL,CACU,SAASC,CAAT,CAAa,CACfA,CAAG,CAAGhC,CAAC,CAACiC,SAAF,CAAYD,CAAZ,CAAN,CACAV,CAAa,CAACF,IAAd,CAAmB,UAAnB,EAA+BI,IAA/B,CAAoC,UAAW,CAC3C,GAAIxB,CAAC,CAAC,IAAD,CAAD,CAAQkC,QAAR,CAAiB,0BAAjB,CAAJ,CAAiD,CAC7C,GAAIC,CAAAA,CAAS,CAAG,eACnB,CAFD,IAEO,IAAGnC,CAAC,CAAC,IAAD,CAAD,CAAQkC,QAAR,CAAiB,yBAAjB,CAAH,CAA+C,CAClD,GAAIC,CAAAA,CAAS,CAAG,cACnB,CAFM,IAED,CACF,GAAIA,CAAAA,CAAS,CAAGnC,CAAC,CAAC,IAAD,CAAD,CAAQoB,IAAR,CAAa,yBAAb,EAAwCC,GAAxC,EACnB,CACD,GAAIc,CAAS,SAAT,EACIH,CAAG,CAACG,CAAD,CAAH,SADR,CACsC,CAClC,MACH,CACD,GAAIC,CAAAA,CAAK,CAAG,CAAZ,CACApC,CAAC,CAACwB,IAAF,CAAO,KAAKa,KAAZ,CAAmB,UAAU,CACzB,GAAc,CAAV,GAAAD,CAAJ,CAAgB,CACZpC,CAAC,CAAC,IAAD,CAAD,CAAQsC,IAAR,CAAaN,CAAG,CAACG,CAAD,CAAH,CAAeC,CAAf,CAAb,CACH,CACDA,CAAK,EACR,CALD,EAMA,GAAsD,CAAlD,CAAApC,CAAC,CAAC,IAAD,CAAD,CAAQoB,IAAR,CAAa,0BAAb,EAAyCD,MAA7C,CAAwD,CACpD,GAAI,CAACnB,CAAC,CAAC,IAAD,CAAD,CAAQkC,QAAR,CAAiB,yBAAjB,CAAL,CAAiD,CAC7ClC,CAAC,CAAC,IAAD,CAAD,CAAQuC,QAAR,CAAiB,yBAAjB,CACH,CACJ,CAJD,IAIK,CACDvC,CAAC,CAAC,IAAD,CAAD,CAAQwC,WAAR,CAAoB,yBAApB,CACH,CACJ,CA1BD,EA2BAxC,CAAC,CAAC,WAAD,CAAD,CAAeoB,IAAf,CAAoB,2BAApB,EAAiDI,IAAjD,CAAsD,UAAW,CAC7DxB,CAAC,CAAC,IAAD,CAAD,CAAQyC,KAAR,CAAc,SAASC,CAAT,CAAY,CACtBhC,MAAM,CAACiC,SAAP,CAAiBD,CAAjB,CAAoB,CAChB,IAAM1C,CAAC,CAAC,IAAD,CAAD,CAAQ4C,IAAR,CAAa,MAAb,CADU,CAEhB,KAAO5C,CAAC,CAAC,IAAD,CAAD,CAAQ4C,IAAR,CAAa,KAAb,CAFS,CAGhB,yIAHgB,CAApB,EAOA5C,CAAC,CAACwB,IAAF,CAAOf,CAAP,CAAsB,SAASoC,CAAT,CAAcC,CAAd,CAAqB,CACvC9C,CAAC,CAAC8C,CAAK,CAACvC,QAAP,CAAD,CAAkBC,KAAlB,CAAwB,UAAW,CAC/BsC,CAAK,CAACC,MAAN,CAAe,IAAf,CAD+B,GAU3BC,CAAAA,CAAK,CAAGC,WAAW,CARH,QAAhBC,CAAAA,aAAgB,EAAW,CAC3B,GAAqD,CAAjD,CAAAlD,CAAC,CAAC,KAAKO,QAAN,CAAD,CAAiBa,IAAjB,CAAsB,gBAAtB,EAAwCD,MAA5C,CAAwD,CACpD,KAAKgC,KAAL,EACH,CACD,GAAI,KAAKC,MAAT,CAAgB,CACZC,aAAa,CAACL,CAAD,CAChB,CACJ,CACuB,CAAcM,IAAd,CAAmBR,CAAnB,CAAD,CAA4B,GAA5B,CAC1B,CAXD,CAYH,CAbD,EAcA9C,CAAC,CAACwB,IAAF,CAf4B,EAe5B,CAA8B,SAASqB,CAAT,CAAcC,CAAd,CAAqB,CAC/CrC,CAAa,CAAC8C,MAAd,CAAqBT,CAArB,CACH,CAFD,CAGH,CAzBD,CA0BH,CA3BD,CA4BH,CA1DL,EA0DOU,IA1DP,CA0DYnD,CAAC,CAACoD,SA1Dd,EA2DKC,MA3DL,CA2DY,UAAW,CACfC,UAAU,CAAC,UAAW,CAClBlC,CAAmB,EACtB,CAFS,CAEP,GAFO,CAGb,CA/DL,CAgEH,CArED,CAsEA,GAAkB,CAAd,CAAAR,CAAI,CAACE,MAAL,EAA0C,CAAvB,CAAAG,CAAa,CAACH,MAAjC,EAAoE,CAArB,CAAAI,CAAW,CAACJ,MAA/D,CAA2E,CACvEM,CAAmB,EACtB,CA/FyB,GAiGtBmC,CAAAA,CAAS,CAAG5D,CAAC,CAAC,oBAAD,CAjGS,CAkGtB6D,CAAa,CAAG,SAAS9C,CAAT,CAAiB,CACjCZ,CAAQ,CAAC2D,YAAT,CAAsB,iBAAtB,CAAyC,YAAzC,CAAuD,CAAvD,CAA0D/C,CAA1D,EACKgB,IADL,CACU,SAASO,CAAT,CAAeyB,CAAf,CAAmB,CACrB,GAAiB,CAAd,CAAAzB,CAAI,CAACnB,MAAR,CAAmB,CACfyC,CAAS,CAACI,GAAV,CAAc,YAAd,CAA4BJ,CAAS,CAACK,WAAV,KAA8B,IAA1D,EACA7D,CAAS,CAAC8D,mBAAV,CAA8BN,CAA9B,CAAyCtB,CAAzC,CAA+CyB,CAA/C,CACH,CACJ,CANL,EAOKP,IAPL,CAOUnD,CAAC,CAACoD,SAPZ,EAQKC,MARL,CAQY,UAAU,CACdC,UAAU,CAAC,UAAU,CACjBE,CAAa,CAAC9C,CAAD,CAChB,CAFS,CAEP,GAFO,CAGb,CAZL,CAaH,CAhHyB,CAkH1B,GAAa,CAAT,CAAAG,CAAM,EAA6B,CAArB,CAAAK,CAAW,CAACJ,MAA9B,CAA0C,CACtC0C,CAAa,CAAC,CAAC3C,MAAM,CAAEA,CAAT,CAAiBY,mBAAmB,CAAEqC,IAAI,CAACC,SAAL,CAAe7C,CAAf,CAAtC,CAAD,CAChB,CACJ,CArHD,CAsHH,CAxHE,CA0HV,CA7HC,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Initialise the an add question modal on the quiz page.\n *\n * @module    quiz_otoverview/table_controller\n * @package   quiz_otoverview\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\ndefine(\n    ['jquery','core/ajax', 'core/yui', 'core/fragment', 'core/templates', 'core/notification'],\n    function($, ajax, Y, fragment, templates, N){\n        return {\n            init: function() {\n                $(document).ready(function () {\n                    var openedWindows = [];\n                    window._open = window.open;\n                    window.open = function(url,name,params){\n                        openedWindows.push(window._open(url,name,params));\n                    };\n\n                    var quiz = $(\"#attemptsform\");\n                    var quizid = 0;\n                    if (quiz.length > 0) {\n                        quizid = quiz.find('input[name=id]').val();\n                    }\n                    var attemptsTable = $('#attempts');\n                    var attemptsIds = [];\n                    if (attemptsTable.length > 0){\n                        attemptsTable.find('tbody tr').each(function() {\n                            var val = $(this).find('td input[type=checkbox]').val();\n                            if (val !== undefined) {\n                                attemptsIds.push(val);\n                            }\n                        });\n                    }\n\n                    var refreshAttemptsData = function() {\n                        var requests = ajax.call([{\n                            methodname : 'quiz_otoverview_get_attempts_data',\n                            args: { quizid: quizid, questionattemptsids: attemptsIds}\n                        }]);\n                        requests[0]\n                            .done(function(res){\n                                res = $.parseJSON(res);\n                                attemptsTable.find('tbody tr').each(function() {\n                                    if ($(this).hasClass('otoverview-averagegroups')){\n                                        var attemptid = 'averagegroups';\n                                    } else if($(this).hasClass('otoverview-averageusers')){\n                                        var attemptid = 'averageusers';\n                                    } else{\n                                        var attemptid = $(this).find('td input[type=checkbox]').val();\n                                    }\n                                    if (attemptid === undefined ||\n                                            res[attemptid] === undefined) {\n                                        return;\n                                    }\n                                    var index = 0;\n                                    $.each(this.cells, function(){\n                                        if (index !== 0){\n                                            $(this).html(res[attemptid][index]);\n                                        }\n                                        index++;\n                                    });\n                                    if ($(this).find('.teacher-action-required').length > 0){\n                                        if (!$(this).hasClass('teacher-action-required')){\n                                            $(this).addClass('teacher-action-required');\n                                        }\n                                    }else{\n                                        $(this).removeClass('teacher-action-required');\n                                    }\n                                });\n                                $('#attempts').find('a.otoverview_action_popup').each(function() {\n                                    $(this).click(function(e) {\n                                        window.openpopup(e, {\n                                            \"url\":$(this).attr('href'),\n                                            \"name\":$(this).attr('act'),\n                                            \"options\":\"height=800,width=600,top=0,left=0,menubar=0,location=0,scrollbars,\"+\n                                                      \"resizable,toolbar,status,directories=0,fullscreen=0,dependent\"\n                                        });\n                                        var windowObjectsToDelete = [];\n                                        $.each(openedWindows, function(key, value) {\n                                            $(value.document).ready(function() {\n                                                value.opener = null;\n                                                var checkFunction = function() {\n                                                    if ($(this.document).find('.alert-success').length > 0) {\n                                                        this.close();\n                                                    }\n                                                    if (this.closed){\n                                                        clearInterval(timer);\n                                                    }\n                                                };\n                                                var timer = setInterval(checkFunction.bind(value), 2000);\n                                            });\n                                        });\n                                        $.each(windowObjectsToDelete, function(key, value) {\n                                            openedWindows.splice(value);\n                                        });\n                                    });\n                                });\n                            }).fail(N.exception)\n                            .always(function() {\n                                setTimeout(function() {\n                                    refreshAttemptsData();\n                                }, 10000);\n                            });\n                    };\n                    if (quiz.length > 0 && attemptsTable.length > 0 && attemptsIds.length > 0) {\n                        refreshAttemptsData();\n                    }\n\n                    var container = $('.otoverview-charts');\n                    var refreshCharts = function(params) {\n                        fragment.loadFragment('quiz_otoverview', 'get_charts', 1, params)\n                            .done(function(html, js) {\n                                if(html.length > 0){\n                                    container.css('min-height', container.outerHeight(true) + 'px');\n                                    templates.replaceNodeContents(container, html, js);\n                                }\n                            })\n                            .fail(N.exception)\n                            .always(function(){\n                                setTimeout(function(){\n                                    refreshCharts(params);\n                                }, 10000);\n                            });\n                    };\n\n                    if (quizid > 0 && attemptsIds.length > 0) {\n                        refreshCharts({quizid: quizid, questionattemptsids: JSON.stringify(attemptsIds)});\n                    }\n                });\n            }\n        };\n    }\n);\n"],"file":"table_controller.min.js"}